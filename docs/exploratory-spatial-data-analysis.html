<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Exploratory (spatial) data analysis | GEOG0114: Principles of Spatial Analysis</title>
  <meta name="description" content="GEOG114: Principles of Spatial Analysis handbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Exploratory (spatial) data analysis | GEOG0114: Principles of Spatial Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jtvandijk.github.io/GEOG0114/" />
  
  <meta property="og:description" content="GEOG114: Principles of Spatial Analysis handbook." />
  <meta name="github-repo" content="jtvandijk/GEOG0114" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Exploratory (spatial) data analysis | GEOG0114: Principles of Spatial Analysis" />
  
  <meta name="twitter:description" content="GEOG114: Principles of Spatial Analysis handbook." />
  

<meta name="author" content="Justin van Dijk and Joanna Wilkin" />


<meta name="date" content="2020-10-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial-autocorrelation.html"/>
<link rel="next" href="point-pattern-analysis.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/module-catalogue/modules/principles-of-spatial-analysis-GEOG0114"><img src="images/general/ucl_logo.png">
</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#get-in-touch"><i class="fa fa-check"></i>Get in touch</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#noticed-a-mistake-in-this-resource"><i class="fa fa-check"></i>Noticed a mistake in this resource?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html"><i class="fa fa-check"></i>Course information</a>
<ul>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#module-structure"><i class="fa fa-check"></i>Module structure</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#weekly-topics"><i class="fa fa-check"></i>Weekly topics</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#learning-objectives"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#reading-list"><i class="fa fa-check"></i>Reading list</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#module-assessment-details"><i class="fa fa-check"></i>Module assessment details</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#useful-additional-resources"><i class="fa fa-check"></i>Useful additional resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="spatial-analysis-for-data-science.html"><a href="spatial-analysis-for-data-science.html"><i class="fa fa-check"></i><b>1</b> Spatial analysis for data science</a></li>
<li class="chapter" data-level="2" data-path="geographical-representation.html"><a href="geographical-representation.html"><i class="fa fa-check"></i><b>2</b> Geographical representation</a></li>
<li class="chapter" data-level="3" data-path="spatial-properties-and-relationships.html"><a href="spatial-properties-and-relationships.html"><i class="fa fa-check"></i><b>3</b> Spatial properties and relationships</a></li>
<li class="chapter" data-level="4" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html"><i class="fa fa-check"></i><b>4</b> Spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#neighbours"><i class="fa fa-check"></i><b>4.1</b> Neighbours</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#setting-up-the-environment"><i class="fa fa-check"></i><b>4.1.1</b> Setting up the environment</a></li>
<li class="chapter" data-level="4.1.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#euclidean-neighbours"><i class="fa fa-check"></i><b>4.1.2</b> Euclidean neighbours</a></li>
<li class="chapter" data-level="4.1.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#shared-boundary-neighbours"><i class="fa fa-check"></i><b>4.1.3</b> Shared boundary neighbours</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#quantifying-difference-over-space"><i class="fa fa-check"></i><b>4.2</b> Quantifying difference over space</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#our-property-is-theft."><i class="fa fa-check"></i><b>4.2.1</b> Our property is theft.</a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#global-morans-i"><i class="fa fa-check"></i><b>4.2.2</b> Global Moran’s I</a></li>
<li class="chapter" data-level="4.2.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-morans-i"><i class="fa fa-check"></i><b>4.2.3</b> Local Moran’s I</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Exploratory (spatial) data analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#tidy-data"><i class="fa fa-check"></i><b>5.1</b> Tidy data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#short-lecture-tidy-data"><i class="fa fa-check"></i><b>5.1.1</b> Short lecture: Tidy data</a></li>
<li class="chapter" data-level="5.1.2" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#what-do-tidy-data-look-like"><i class="fa fa-check"></i><b>5.1.2</b> What do tidy data look like?</a></li>
<li class="chapter" data-level="5.1.3" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#creating-tidy-data"><i class="fa fa-check"></i><b>5.1.3</b> Creating tidy data</a></li>
<li class="chapter" data-level="5.1.4" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#assignment_w05"><i class="fa fa-check"></i><b>5.1.4</b> Assignments</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#exploratory-spatial-data-analysis-in"><i class="fa fa-check"></i><b>5.2</b> Exploratory (spatial) data analysis in</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#short-lecture-exploratory-spatial-data-analysis"><i class="fa fa-check"></i><b>5.2.1</b> Short lecture: Exploratory (spatial) data analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#spatial-heterogeneity"><i class="fa fa-check"></i><b>5.3</b> Spatial heterogeneity</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#short-lecture-spatial-heterogeneity"><i class="fa fa-check"></i><b>5.3.1</b> Short lecture: Spatial heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#attributions_w05"><i class="fa fa-check"></i><b>5.4</b> Attributions</a></li>
<li class="chapter" data-level="5.5" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#feedback_w05"><i class="fa fa-check"></i><b>5.5</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html"><i class="fa fa-check"></i><b>6</b> Point pattern analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#feedback_w06"><i class="fa fa-check"></i><b>6.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="geostatistics.html"><a href="geostatistics.html"><i class="fa fa-check"></i><b>7</b> Geostatistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="geostatistics.html"><a href="geostatistics.html#feedback_w07"><i class="fa fa-check"></i><b>7.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cluster-analysis.html"><a href="cluster-analysis.html"><i class="fa fa-check"></i><b>8</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#feedback_w08"><i class="fa fa-check"></i><b>8.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-modelling.html"><a href="bayesian-modelling.html"><i class="fa fa-check"></i><b>9</b> Bayesian modelling</a></li>
<li class="chapter" data-level="10" data-path="reproducible-research.html"><a href="reproducible-research.html"><i class="fa fa-check"></i><b>10</b> Reproducible research</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEOG0114: Principles of Spatial Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-spatial-data-analysis" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Exploratory (spatial) data analysis</h1>
<p>This week, we focus on the second of the two key properties of spatial data: spatial heterogeneity. With the underlying process (or processes) that govern a spatial variable likely to vary across space, a single global relationship for an entire region of study may not adequately model the process that governs outcomes in any given location of the study region. As a result, multiple methods have been developed to incorporate ‘space’ into traditional regression models, including spatial lag models, spatial error models, and Geographical Weighted Regression.</p>
<p>This week provides the building blocks to conducting a statistical and spatial investigation into the relationships between spatial variables, first looking at the concepts of <strong>tidy data</strong> and <strong>Exploratory Spatial Data Analysis (ESDA)</strong>. We then look at the three types of spatial regression models in turn to understand their methodology and potential advantages and limitations in accounting for space when modelling relationships.</p>
<p>In this week’s session we will explore potential factors that may contribute to our crime rate in London, using previous literature to identify variables for inclusion in our analysis. We conduct an ESDA of these variables, followed by statistical and spatial regression analysis to determine whether our variables adhere to previous literature and do contribute to crime in our area of study.</p>
<p>This week is structured by <strong>three</strong> short lecture videos, <strong>two</strong> <a href="exploratory-spatial-data-analysis.html#assignment_w05">assignments</a> that you need to do in preparation for Friday’s seminar, and practical material. As always, this <a href="https://rl.talis.com/3/ucl/lists/3FB0C66A-F603-A402-A31C-28F2DA091AB6.html?lang=en-gb&amp;login=1">week’s reading list</a> is provided on the UCL library reading list page for the course.</p>
<div id="tidy-data" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Tidy data</h2>
<p>Over the past weeks a lot of information has come your way, diving deep into the world of Spatial Data Science. However, whilst you are slowly becoming proficient in using R and Python to solve complex (spatial) problems, it is now a good moment to start thinking about data themselves and how they are organised. This is crucial for when you are moving on to working on your own projects where you have to source data yourselves: the vast majority of the data you will find in the public domain (or private domain for that matter) will be <strong>dirty data</strong>. With dirty data we mean data that needs some form of pre-processing, cleaning, and linkage before you can use it for your analysis. Exploratory (Spatial) Data Analysis very much starts with your data preparation.</p>
<p>In the following, you will learn a consistent way to structure your data in R: <strong>tidy data</strong>. Tidy data, as formalised by <a href="http://hadley.nz/">R Wizard Hadley Wickham</a> in his contribution to the <a href="http://www.jstatsoft.org/v59/i10/paper">Journal of Statistical Software</a> is not only very much at the core of the <code>tidyverse()</code> R package, but also of general importance when organising your data. In the words, of <a href="https://r4ds.had.co.nz/tidy-data.html">the Wizard</a>:</p>
<blockquote>
<p>Once you have tidy data and the tidy tools provided by packages in the tidyverse, you will spend much less time munging data from one representation to another, allowing you to spend more time on the analytic questions at hand.</p>
</blockquote>
<div id="short-lecture-tidy-data" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Short lecture: Tidy data</h3>
<p><a href="">[Lecture slides]</a> <a href="">[Watch on MS stream]</a></p>
</div>
<div id="what-do-tidy-data-look-like" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> What do tidy data look like?</h3>
<p>You can represent the same underlying data in multiple ways. The example below, taken from the the <code>tidyverse()</code> package and described in the <a href="https://r4ds.had.co.nz/tidy-data.html">R for Data Science</a> book, shows that the same data can organised in four different ways.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="exploratory-spatial-data-analysis.html#cb65-1" aria-hidden="true"></a><span class="co"># load the tidyverse </span></span>
<span id="cb65-2"><a href="exploratory-spatial-data-analysis.html#cb65-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>Table <strong>1</strong>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="exploratory-spatial-data-analysis.html#cb66-1" aria-hidden="true"></a>table1</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Table <strong>2</strong>:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="exploratory-spatial-data-analysis.html#cb68-1" aria-hidden="true"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>Table <strong>3</strong>:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="exploratory-spatial-data-analysis.html#cb70-1" aria-hidden="true"></a>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p>Table <strong>4a</strong>:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="exploratory-spatial-data-analysis.html#cb72-1" aria-hidden="true"></a>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<p>Table <strong>4b</strong>:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="exploratory-spatial-data-analysis.html#cb74-1" aria-hidden="true"></a>table4b</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
## * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<p>None of these representations are wrong per se, however, not are equally easy to use. Only Table <strong>1</strong> can be considered as tidy data because it is the only table that adheres to the three rules that make a dataset tidy:</p>
<ol style="list-style-type: decimal">
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ol>
<div class="figure" style="text-align: center"><span id="fig:05-figure-hadley-wickham"></span>
<img src="images/week05/05_a_tidy_data.png" alt="A visual representation of tidy data by [Hadley Wickham](https://r4ds.had.co.nz/tidy-data.html)." width="960" />
<p class="caption">
Figure 5.1: A visual representation of tidy data by <a href="https://r4ds.had.co.nz/tidy-data.html">Hadley Wickham</a>.
</p>
</div>
</div>
<div id="creating-tidy-data" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Creating tidy data</h3>
<p>Now we know what consitute tidy data, we can put this into practice with an example using some data from the <a href="https://www.ons.gov.uk/">Office for National Statistics</a>. Let’s say we need to analyse some data on the ethnic background of the UK population, for instance, because we want to get some insights into the relationship between <a href="https://www.theguardian.com/world/2020/oct/09/bame-groups-hit-hard-again-covid-second-wave-grips-uk-nations">COVID-19 and ethnic background</a>. Our assignment is to calculate the relative proportions of each ethnic group within the administrative geography of the <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/middlesuperoutputareamidyearpopulationestimates">Middle layer Super Output Area (MSOA)</a>. In order to do this, we have been given a file that contains data on ethnicity by age group at the MSOA-level of every person in the 2011 UK Census who is 16 year or older. Download the file to your own computer and <a href="spatial-autocorrelation.html#setting-up-the-environment">set up your data directory</a> in the same fashion as you did last week.</p>
 
<center>
<strong>You can download the file <a href="https://github.com/jtvandijk/GEOG0114/tree/master/raw/population/eth_pop_2011/msoa_eth2011_ew_16plus.csv">here</a>.</strong>
</center>
<p> </p>
<p>We start by making sure our <code>tidyverse()</code> is loaded into R and using the <code>read_csv()</code> function to read our <code>.csv</code> file.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="exploratory-spatial-data-analysis.html#cb76-1" aria-hidden="true"></a><span class="co"># load the tidyverse </span></span>
<span id="cb76-2"><a href="exploratory-spatial-data-analysis.html#cb76-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb76-3"><a href="exploratory-spatial-data-analysis.html#cb76-3" aria-hidden="true"></a></span>
<span id="cb76-4"><a href="exploratory-spatial-data-analysis.html#cb76-4" aria-hidden="true"></a><span class="co"># read data into dataframe</span></span>
<span id="cb76-5"><a href="exploratory-spatial-data-analysis.html#cb76-5" aria-hidden="true"></a>df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;raw/population/eth_pop_2011/msoa_eth2011_ew_16plus.csv&#39;</span>)</span>
<span id="cb76-6"><a href="exploratory-spatial-data-analysis.html#cb76-6" aria-hidden="true"></a>  </span>
<span id="cb76-7"><a href="exploratory-spatial-data-analysis.html#cb76-7" aria-hidden="true"></a><span class="co"># inspect the dataframe: number of columns</span></span>
<span id="cb76-8"><a href="exploratory-spatial-data-analysis.html#cb76-8" aria-hidden="true"></a><span class="kw">ncol</span>(df)</span></code></pre></div>
<pre><code>## [1] 385</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="exploratory-spatial-data-analysis.html#cb78-1" aria-hidden="true"></a><span class="co"># inspect the dataframe: number of rows</span></span>
<span id="cb78-2"><a href="exploratory-spatial-data-analysis.html#cb78-2" aria-hidden="true"></a><span class="kw">nrow</span>(df)</span></code></pre></div>
<pre><code>## [1] 7201</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="exploratory-spatial-data-analysis.html#cb80-1" aria-hidden="true"></a><span class="co"># inspect the dataframe: sneak peak</span></span>
<span id="cb80-2"><a href="exploratory-spatial-data-analysis.html#cb80-2" aria-hidden="true"></a><span class="kw">print</span>(df, <span class="dt">n_extra=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 7,201 x 385
##    msoa11cd `Sex: All perso… `Sex: All perso… `Sex: All perso… `Sex: All perso…
##    &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 E020025…              215              206              204                0
##  2 E020025…              175              170              168                1
##  3 E020025…              140              128              128                0
##  4 E020025…              160              155              154                0
##  5 E020025…              132              130              130                0
##  6 E020025…              270              263              261                0
##  7 E020025…              124              119              117                0
##  8 E020025…              150              125              117                0
##  9 E020025…              178              166              159                0
## 10 E020025…              162              159              157                0
## # … with 7,191 more rows, and 380 more variables: `Sex: All persons; Age: Age
## #   16 to 17; Ethnic Group: White: Gypsy or Irish Traveller; measures:
## #   Value` &lt;dbl&gt;, `Sex: All persons; Age: Age 16 to 17; Ethnic Group: White:
## #   Other White; measures: Value` &lt;dbl&gt;, …</code></pre>
<p>It is clear that the data are not directly suitable to establish the proportion of each ethnic group within the population of each MSOA because the data are split out over multiple columns. Let’s inspect the names of the columns to get a better idea of the structure of our data set.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="exploratory-spatial-data-analysis.html#cb82-1" aria-hidden="true"></a><span class="co"># inspect the dataframe: column names</span></span>
<span id="cb82-2"><a href="exploratory-spatial-data-analysis.html#cb82-2" aria-hidden="true"></a><span class="kw">names</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;msoa11cd&quot;                                                                                                                  
##  [2] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: All categories: Ethnic group; measures: Value&quot;                          
##  [3] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Total; measures: Value&quot;                                          
##  [4] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: English/Welsh/Scottish/Northern Irish/British; measures: Value&quot;  
##  [5] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Irish; measures: Value&quot;                                          
##  [6] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Gypsy or Irish Traveller; measures: Value&quot;                       
##  [7] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Other White; measures: Value&quot;                                    
##  [8] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/multiple ethnic group: Total; measures: Value&quot;                    
##  [9] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/multiple ethnic group: White and Black Caribbean; measures: Value&quot;
## [10] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/multiple ethnic group: White and Black African; measures: Value&quot;  
## [11] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/multiple ethnic group: White and Asian; measures: Value&quot;          
## [12] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/multiple ethnic group: Other Mixed; measures: Value&quot;              
## [13] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Asian/Asian British: Total; measures: Value&quot;                            
## [14] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Asian/Asian British: Indian; measures: Value&quot;                           
## [15] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Asian/Asian British: Pakistani; measures: Value&quot;                        
## [16] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Asian/Asian British: Bangladeshi; measures: Value&quot;                      
## [17] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Asian/Asian British: Chinese; measures: Value&quot;                          
## [18] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Asian/Asian British: Other Asian; measures: Value&quot;                      
## [19] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Black/African/Caribbean/Black British: Total; measures: Value&quot;          
## [20] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Black/African/Caribbean/Black British: African; measures: Value&quot;        
## [21] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Black/African/Caribbean/Black British: Caribbean; measures: Value&quot;      
## [22] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Black/African/Caribbean/Black British: Other Black; measures: Value&quot;    
## [23] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Other ethnic group: Total; measures: Value&quot;                             
## [24] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Other ethnic group: Arab; measures: Value&quot;                              
## [25] &quot;Sex: All persons; Age: Age 16 to 17; Ethnic Group: Other ethnic group: Any other ethnic group; measures: Value&quot;            
## [26] &quot;Sex: All persons; Age: Age 18 to 19; Ethnic Group: All categories: Ethnic group; measures: Value&quot;                          
## [27] &quot;Sex: All persons; Age: Age 18 to 19; Ethnic Group: White: Total; measures: Value&quot;                                          
## [28] &quot;Sex: All persons; Age: Age 18 to 19; Ethnic Group: White: English/Welsh/Scottish/Northern Irish/British; measures: Value&quot;  
## [29] &quot;Sex: All persons; Age: Age 18 to 19; Ethnic Group: White: Irish; measures: Value&quot;                                          
## [30] &quot;Sex: All persons; Age: Age 18 to 19; Ethnic Group: White: Gypsy or Irish Traveller; measures: Value&quot;                       
##  [ reached getOption(&quot;max.print&quot;) -- omitted 355 entries ]</code></pre>
<p>The column names are all awfully long and it looks like that the data have been split out into age groups. Further to this, the data contain within group total counts: <em>all categories</em>, <em>white total</em>, <em>mixed/multiple ethnic group total</em>, and so on. You can also try using <code>View(df)</code> to browse through the dataset to get a better idea of what is happening.</p>
<p>Although the data is messy and we will need to reorganise our data set, it does look there is some form of structure present that we can exploit: the various columns are repeated for each for the different age groups. This means that we can go through the data frame in steps of equal size to select the data we want: starting from column 2 (column 1 only contains the reference to the adminsitrative geography) we want to select all 24 columns of data for that particular age group. We create a <code>for</code> loop that does exactly that:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="exploratory-spatial-data-analysis.html#cb84-1" aria-hidden="true"></a><span class="co"># loop through the columns of our data set</span></span>
<span id="cb84-2"><a href="exploratory-spatial-data-analysis.html#cb84-2" aria-hidden="true"></a><span class="cf">for</span> (column <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,<span class="kw">ncol</span>(df),<span class="dv">24</span>)) {</span>
<span id="cb84-3"><a href="exploratory-spatial-data-analysis.html#cb84-3" aria-hidden="true"></a>    </span>
<span id="cb84-4"><a href="exploratory-spatial-data-analysis.html#cb84-4" aria-hidden="true"></a>  <span class="co"># index number of start column of age group</span></span>
<span id="cb84-5"><a href="exploratory-spatial-data-analysis.html#cb84-5" aria-hidden="true"></a>  start &lt;-<span class="st"> </span>column</span>
<span id="cb84-6"><a href="exploratory-spatial-data-analysis.html#cb84-6" aria-hidden="true"></a>  </span>
<span id="cb84-7"><a href="exploratory-spatial-data-analysis.html#cb84-7" aria-hidden="true"></a>  <span class="co"># index number of end column of age group</span></span>
<span id="cb84-8"><a href="exploratory-spatial-data-analysis.html#cb84-8" aria-hidden="true"></a>  stop &lt;-<span class="st"> </span>column <span class="op">+</span><span class="st"> </span><span class="dv">23</span> </span>
<span id="cb84-9"><a href="exploratory-spatial-data-analysis.html#cb84-9" aria-hidden="true"></a>  </span>
<span id="cb84-10"><a href="exploratory-spatial-data-analysis.html#cb84-10" aria-hidden="true"></a>  <span class="co"># print results</span></span>
<span id="cb84-11"><a href="exploratory-spatial-data-analysis.html#cb84-11" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="kw">c</span>(start,stop))</span>
<span id="cb84-12"><a href="exploratory-spatial-data-analysis.html#cb84-12" aria-hidden="true"></a>}</span></code></pre></div>
<pre><code>## [1]  2 25
## [1] 26 49
## [1] 50 73
## [1] 74 97
## [1]  98 121
## [1] 122 145
## [1] 146 169
## [1] 170 193
## [1] 194 217
## [1] 218 241
## [1] 242 265
## [1] 266 289
## [1] 290 313
## [1] 314 337
## [1] 338 361
## [1] 362 385</code></pre>
<p>For each age group in our data, the printed values should <strong>(!)</strong> correspond with the index number of the start column of the age group and the index number of the end column of the age group, respectively. Let’s do a sanity check.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="exploratory-spatial-data-analysis.html#cb86-1" aria-hidden="true"></a><span class="co"># sanity check: age group 16-17 (start column)</span></span>
<span id="cb86-2"><a href="exploratory-spatial-data-analysis.html#cb86-2" aria-hidden="true"></a>df[,<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## # A tibble: 7,201 x 1
##    `Sex: All persons; Age: Age 16 to 17; Ethnic Group: All categories: Ethnic g…
##                                                                            &lt;dbl&gt;
##  1                                                                           215
##  2                                                                           175
##  3                                                                           140
##  4                                                                           160
##  5                                                                           132
##  6                                                                           270
##  7                                                                           124
##  8                                                                           150
##  9                                                                           178
## 10                                                                           162
## # … with 7,191 more rows</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="exploratory-spatial-data-analysis.html#cb88-1" aria-hidden="true"></a><span class="co"># sanity check: age group 16-17 (end column)</span></span>
<span id="cb88-2"><a href="exploratory-spatial-data-analysis.html#cb88-2" aria-hidden="true"></a>df[,<span class="dv">25</span>]</span></code></pre></div>
<pre><code>## # A tibble: 7,201 x 1
##    `Sex: All persons; Age: Age 16 to 17; Ethnic Group: Other ethnic group: Any …
##                                                                            &lt;dbl&gt;
##  1                                                                             0
##  2                                                                             0
##  3                                                                             0
##  4                                                                             0
##  5                                                                             0
##  6                                                                             0
##  7                                                                             0
##  8                                                                             0
##  9                                                                             0
## 10                                                                             0
## # … with 7,191 more rows</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="exploratory-spatial-data-analysis.html#cb90-1" aria-hidden="true"></a><span class="co"># sanity check: age group 18-19 (start column)</span></span>
<span id="cb90-2"><a href="exploratory-spatial-data-analysis.html#cb90-2" aria-hidden="true"></a>df[,<span class="dv">26</span>]</span></code></pre></div>
<pre><code>## # A tibble: 7,201 x 1
##    `Sex: All persons; Age: Age 18 to 19; Ethnic Group: All categories: Ethnic g…
##                                                                            &lt;dbl&gt;
##  1                                                                           157
##  2                                                                           129
##  3                                                                           102
##  4                                                                           162
##  5                                                                           121
##  6                                                                           217
##  7                                                                           126
##  8                                                                           231
##  9                                                                           175
## 10                                                                            95
## # … with 7,191 more rows</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="exploratory-spatial-data-analysis.html#cb92-1" aria-hidden="true"></a><span class="co"># sanity check: age group 18-19 (end column)</span></span>
<span id="cb92-2"><a href="exploratory-spatial-data-analysis.html#cb92-2" aria-hidden="true"></a>df[,<span class="dv">49</span>]</span></code></pre></div>
<pre><code>## # A tibble: 7,201 x 1
##    `Sex: All persons; Age: Age 18 to 19; Ethnic Group: Other ethnic group: Any …
##                                                                            &lt;dbl&gt;
##  1                                                                             1
##  2                                                                             0
##  3                                                                             0
##  4                                                                             0
##  5                                                                             0
##  6                                                                             0
##  7                                                                             0
##  8                                                                             1
##  9                                                                             0
## 10                                                                             0
## # … with 7,191 more rows</code></pre>
<p>All seems to be correct and we have successfully identified our columns. This is great, however, we still cannot work with our data as everything is spread out over different columns. Let’s fix this by manipulating the shape of our data by turning columns into rows.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="exploratory-spatial-data-analysis.html#cb94-1" aria-hidden="true"></a><span class="co"># create function</span></span>
<span id="cb94-2"><a href="exploratory-spatial-data-analysis.html#cb94-2" aria-hidden="true"></a>columns_to_rows &lt;-<span class="st"> </span><span class="cf">function</span>(df, start, stop) {</span>
<span id="cb94-3"><a href="exploratory-spatial-data-analysis.html#cb94-3" aria-hidden="true"></a>  </span>
<span id="cb94-4"><a href="exploratory-spatial-data-analysis.html#cb94-4" aria-hidden="true"></a>  <span class="co"># columns we are interested in</span></span>
<span id="cb94-5"><a href="exploratory-spatial-data-analysis.html#cb94-5" aria-hidden="true"></a>  col_sub &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,start<span class="op">:</span>stop)</span>
<span id="cb94-6"><a href="exploratory-spatial-data-analysis.html#cb94-6" aria-hidden="true"></a>  </span>
<span id="cb94-7"><a href="exploratory-spatial-data-analysis.html#cb94-7" aria-hidden="true"></a>  <span class="co"># subset the dataframe </span></span>
<span id="cb94-8"><a href="exploratory-spatial-data-analysis.html#cb94-8" aria-hidden="true"></a>  df_sub &lt;-<span class="st"> </span><span class="kw">select</span>(df,col_sub)</span>
<span id="cb94-9"><a href="exploratory-spatial-data-analysis.html#cb94-9" aria-hidden="true"></a>  </span>
<span id="cb94-10"><a href="exploratory-spatial-data-analysis.html#cb94-10" aria-hidden="true"></a>  <span class="co"># pivot the columns in the dataframe, exclude the MSOA code column </span></span>
<span id="cb94-11"><a href="exploratory-spatial-data-analysis.html#cb94-11" aria-hidden="true"></a>  df_piv &lt;-<span class="st"> </span><span class="kw">pivot_longer</span>(df_sub,<span class="op">!</span>msoa11cd)</span>
<span id="cb94-12"><a href="exploratory-spatial-data-analysis.html#cb94-12" aria-hidden="true"></a>  </span>
<span id="cb94-13"><a href="exploratory-spatial-data-analysis.html#cb94-13" aria-hidden="true"></a>  <span class="co"># rename columns</span></span>
<span id="cb94-14"><a href="exploratory-spatial-data-analysis.html#cb94-14" aria-hidden="true"></a>  <span class="kw">names</span>(df_piv) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;msoa11cd&#39;</span>,<span class="st">&#39;age_group&#39;</span>,<span class="st">&#39;count&#39;</span>)</span>
<span id="cb94-15"><a href="exploratory-spatial-data-analysis.html#cb94-15" aria-hidden="true"></a>  <span class="kw">return</span>(df_piv)</span>
<span id="cb94-16"><a href="exploratory-spatial-data-analysis.html#cb94-16" aria-hidden="true"></a>}</span>
<span id="cb94-17"><a href="exploratory-spatial-data-analysis.html#cb94-17" aria-hidden="true"></a></span>
<span id="cb94-18"><a href="exploratory-spatial-data-analysis.html#cb94-18" aria-hidden="true"></a><span class="co"># test</span></span>
<span id="cb94-19"><a href="exploratory-spatial-data-analysis.html#cb94-19" aria-hidden="true"></a><span class="kw">columns_to_rows</span>(df,<span class="dv">2</span>,<span class="dv">25</span>)</span></code></pre></div>
<pre><code>## # A tibble: 172,824 x 3
##    msoa11cd  age_group                                                     count
##    &lt;chr&gt;     &lt;chr&gt;                                                         &lt;dbl&gt;
##  1 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: All categ…   215
##  2 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: To…   206
##  3 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: En…   204
##  4 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Ir…     0
##  5 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Gy…     2
##  6 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Ot…     0
##  7 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     4
##  8 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     1
##  9 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     2
## 10 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     1
## # … with 172,814 more rows</code></pre>
<p>This looks much better. Now let’s combine our loop with our newly created function to apply this to all of our data.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="exploratory-spatial-data-analysis.html#cb96-1" aria-hidden="true"></a><span class="co"># create an empty list to store our result from the loop</span></span>
<span id="cb96-2"><a href="exploratory-spatial-data-analysis.html#cb96-2" aria-hidden="true"></a>df_lst &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb96-3"><a href="exploratory-spatial-data-analysis.html#cb96-3" aria-hidden="true"></a></span>
<span id="cb96-4"><a href="exploratory-spatial-data-analysis.html#cb96-4" aria-hidden="true"></a><span class="co"># loop through the columns of our data set</span></span>
<span id="cb96-5"><a href="exploratory-spatial-data-analysis.html#cb96-5" aria-hidden="true"></a><span class="cf">for</span> (column <span class="cf">in</span> <span class="kw">seq</span>(<span class="dv">2</span>,<span class="kw">ncol</span>(df),<span class="dv">24</span>)) {</span>
<span id="cb96-6"><a href="exploratory-spatial-data-analysis.html#cb96-6" aria-hidden="true"></a>    </span>
<span id="cb96-7"><a href="exploratory-spatial-data-analysis.html#cb96-7" aria-hidden="true"></a>  <span class="co"># index number of start column of age group</span></span>
<span id="cb96-8"><a href="exploratory-spatial-data-analysis.html#cb96-8" aria-hidden="true"></a>  start &lt;-<span class="st"> </span>column</span>
<span id="cb96-9"><a href="exploratory-spatial-data-analysis.html#cb96-9" aria-hidden="true"></a>  </span>
<span id="cb96-10"><a href="exploratory-spatial-data-analysis.html#cb96-10" aria-hidden="true"></a>  <span class="co"># index number of end column of age group</span></span>
<span id="cb96-11"><a href="exploratory-spatial-data-analysis.html#cb96-11" aria-hidden="true"></a>  stop &lt;-<span class="st"> </span>column <span class="op">+</span><span class="st"> </span><span class="dv">23</span> </span>
<span id="cb96-12"><a href="exploratory-spatial-data-analysis.html#cb96-12" aria-hidden="true"></a>  </span>
<span id="cb96-13"><a href="exploratory-spatial-data-analysis.html#cb96-13" aria-hidden="true"></a>  <span class="co"># call our function and assign it to the list</span></span>
<span id="cb96-14"><a href="exploratory-spatial-data-analysis.html#cb96-14" aria-hidden="true"></a>  df_lst[[<span class="kw">length</span>(df_lst)<span class="op">+</span><span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw">columns_to_rows</span>(df,<span class="dt">start=</span>start,<span class="dt">stop=</span>stop)</span>
<span id="cb96-15"><a href="exploratory-spatial-data-analysis.html#cb96-15" aria-hidden="true"></a>}</span>
<span id="cb96-16"><a href="exploratory-spatial-data-analysis.html#cb96-16" aria-hidden="true"></a></span>
<span id="cb96-17"><a href="exploratory-spatial-data-analysis.html#cb96-17" aria-hidden="true"></a><span class="co"># paste all elements from the list underneath one another</span></span>
<span id="cb96-18"><a href="exploratory-spatial-data-analysis.html#cb96-18" aria-hidden="true"></a>df_reformatted &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">do.call</span>(rbind,df_lst))</span>
<span id="cb96-19"><a href="exploratory-spatial-data-analysis.html#cb96-19" aria-hidden="true"></a></span>
<span id="cb96-20"><a href="exploratory-spatial-data-analysis.html#cb96-20" aria-hidden="true"></a><span class="co"># and the result</span></span>
<span id="cb96-21"><a href="exploratory-spatial-data-analysis.html#cb96-21" aria-hidden="true"></a>df_reformatted</span></code></pre></div>
<pre><code>## # A tibble: 2,765,184 x 3
##    msoa11cd  age_group                                                     count
##    &lt;chr&gt;     &lt;chr&gt;                                                         &lt;dbl&gt;
##  1 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: All categ…   215
##  2 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: To…   206
##  3 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: En…   204
##  4 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Ir…     0
##  5 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Gy…     2
##  6 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: White: Ot…     0
##  7 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     4
##  8 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     1
##  9 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     2
## 10 E02002559 Sex: All persons; Age: Age 16 to 17; Ethnic Group: Mixed/mul…     1
## # … with 2,765,174 more rows</code></pre>
<p>Now the data is in a much more managable format, we can move on with preparing the data further. We will start by filtering out the columns (now rows!) that contain <em>all categories</em> and the <em>within group totals</em>. We will do this by cleverly filtering our data set on only a part of the text string that is contained in the <em>age_group</em> column of our dataframe using a <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expression</a>. We further truncate the information that is contained in the <em>age_group</em> column to make all a little more readable.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="exploratory-spatial-data-analysis.html#cb98-1" aria-hidden="true"></a><span class="co"># filter rows</span></span>
<span id="cb98-2"><a href="exploratory-spatial-data-analysis.html#cb98-2" aria-hidden="true"></a>df_reformatted &lt;-<span class="st"> </span><span class="kw">filter</span>(df_reformatted,<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;*All categories*&#39;</span>,age_group))</span>
<span id="cb98-3"><a href="exploratory-spatial-data-analysis.html#cb98-3" aria-hidden="true"></a>df_reformatted &lt;-<span class="st"> </span><span class="kw">filter</span>(df_reformatted,<span class="op">!</span><span class="kw">grepl</span>(<span class="st">&#39;*Total*&#39;</span>,age_group))</span>
<span id="cb98-4"><a href="exploratory-spatial-data-analysis.html#cb98-4" aria-hidden="true"></a></span>
<span id="cb98-5"><a href="exploratory-spatial-data-analysis.html#cb98-5" aria-hidden="true"></a><span class="co"># truncate information</span></span>
<span id="cb98-6"><a href="exploratory-spatial-data-analysis.html#cb98-6" aria-hidden="true"></a>df_reformatted<span class="op">$</span>g &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&#39;85&#39;</span>,<span class="kw">as.character</span>(df_reformatted<span class="op">$</span>age_group)),<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb98-7"><a href="exploratory-spatial-data-analysis.html#cb98-7" aria-hidden="true"></a>df_reformatted &lt;-<span class="st"> </span><span class="kw">mutate</span>(df_reformatted,<span class="dt">group =</span> <span class="kw">ifelse</span>(g<span class="op">==</span><span class="dv">0</span>,<span class="kw">substr</span>(<span class="kw">as.character</span>(age_group),<span class="dv">38</span>,<span class="dv">500</span>),</span>
<span id="cb98-8"><a href="exploratory-spatial-data-analysis.html#cb98-8" aria-hidden="true"></a>                                                            <span class="kw">substr</span>(<span class="kw">as.character</span>(age_group),<span class="dv">41</span>,<span class="dv">500</span>))) </span>
<span id="cb98-9"><a href="exploratory-spatial-data-analysis.html#cb98-9" aria-hidden="true"></a></span>
<span id="cb98-10"><a href="exploratory-spatial-data-analysis.html#cb98-10" aria-hidden="true"></a><span class="co"># remove unnecessary columns</span></span>
<span id="cb98-11"><a href="exploratory-spatial-data-analysis.html#cb98-11" aria-hidden="true"></a>df_reformatted &lt;-<span class="st"> </span><span class="kw">select</span>(df_reformatted, <span class="op">-</span>age_group, <span class="op">-</span>g)</span></code></pre></div>
<p>We are now really getting somewhere, although in order for our data to be tidy each variable must have its own column. We also want, within each ethnic group, to have the sum of the values that used to belong to individual age groups.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="exploratory-spatial-data-analysis.html#cb99-1" aria-hidden="true"></a><span class="co"># pivot table and aggregate values</span></span>
<span id="cb99-2"><a href="exploratory-spatial-data-analysis.html#cb99-2" aria-hidden="true"></a>df_clean &lt;-<span class="st"> </span><span class="kw">pivot_wider</span>(df_reformatted,<span class="dt">names_from=</span>group,<span class="dt">values_from=</span>count,<span class="dt">values_fn=</span>sum)</span>
<span id="cb99-3"><a href="exploratory-spatial-data-analysis.html#cb99-3" aria-hidden="true"></a></span>
<span id="cb99-4"><a href="exploratory-spatial-data-analysis.html#cb99-4" aria-hidden="true"></a><span class="co"># reorder columns alphabetically and rename column names</span></span>
<span id="cb99-5"><a href="exploratory-spatial-data-analysis.html#cb99-5" aria-hidden="true"></a><span class="kw">names</span>(df_clean) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;msoa11cd&#39;</span>,<span class="st">&#39;white_british&#39;</span>,<span class="st">&#39;white_irish&#39;</span>,<span class="st">&#39;white_traveller&#39;</span>,<span class="st">&#39;white_other&#39;</span>,<span class="st">&#39;mixed_white_black_caribbean&#39;</span>,</span>
<span id="cb99-6"><a href="exploratory-spatial-data-analysis.html#cb99-6" aria-hidden="true"></a>                     <span class="st">&#39;mixed_white_black_african&#39;</span>,<span class="st">&#39;mixed_white_asian&#39;</span>,<span class="st">&#39;mixed_other&#39;</span>,<span class="st">&#39;asian_indian&#39;</span>,<span class="st">&#39;asian_pakistani&#39;</span>,</span>
<span id="cb99-7"><a href="exploratory-spatial-data-analysis.html#cb99-7" aria-hidden="true"></a>                     <span class="st">&#39;asian_bangladeshi&#39;</span>,<span class="st">&#39;asian_chinese&#39;</span>,<span class="st">&#39;asian_other&#39;</span>,<span class="st">&#39;black_african&#39;</span>,<span class="st">&#39;black_caribbean&#39;</span>,<span class="st">&#39;black_other&#39;</span>,</span>
<span id="cb99-8"><a href="exploratory-spatial-data-analysis.html#cb99-8" aria-hidden="true"></a>                     <span class="st">&#39;other_arab&#39;</span>,<span class="st">&#39;other_other&#39;</span>)</span>
<span id="cb99-9"><a href="exploratory-spatial-data-analysis.html#cb99-9" aria-hidden="true"></a></span>
<span id="cb99-10"><a href="exploratory-spatial-data-analysis.html#cb99-10" aria-hidden="true"></a><span class="co"># tidy date</span></span>
<span id="cb99-11"><a href="exploratory-spatial-data-analysis.html#cb99-11" aria-hidden="true"></a>df_clean</span></code></pre></div>
<pre><code>## # A tibble: 7,201 x 19
##    msoa11cd white_british white_irish white_traveller white_other
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;
##  1 E020025…          6775          17              27          51
##  2 E020025…          4688          11               8          31
##  3 E020025…          4609          20               3          55
##  4 E020025…          4653           4               6         131
##  5 E020025…          4369          13               2          38
##  6 E020025…          7320          11               3          73
##  7 E020025…          4274          16               2          96
##  8 E020025…          4713          33              24         308
##  9 E020025…          5344          17              42         111
## 10 E020025…          4583          29               6         100
## # … with 7,191 more rows, and 14 more variables:
## #   mixed_white_black_caribbean &lt;dbl&gt;, mixed_white_black_african &lt;dbl&gt;,
## #   mixed_white_asian &lt;dbl&gt;, mixed_other &lt;dbl&gt;, asian_indian &lt;dbl&gt;,
## #   asian_pakistani &lt;dbl&gt;, asian_bangladeshi &lt;dbl&gt;, asian_chinese &lt;dbl&gt;,
## #   asian_other &lt;dbl&gt;, black_african &lt;dbl&gt;, black_caribbean &lt;dbl&gt;,
## #   black_other &lt;dbl&gt;, other_arab &lt;dbl&gt;, other_other &lt;dbl&gt;</code></pre>
<p>Finally. We now have a <strong>tidy</strong> dataset that we can work with!</p>
</div>
<div id="assignment_w05" class="section level3" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> Assignments</h3>
<div id="assignment-1" class="section level4 unnumbered">
<h4>Assignment 1</h4>
<p>Since we went through all the trouble in cleaning and creating this file, the first task for Friday’s seminar is to finalise the analysis: use the cleaned data set to create a table that, for each MSOA, contains the proportions of the population belonging to each of the ethnic groups in the UK 2011 Census of Population. It could look something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">msoa11cd</th>
<th align="center">white_british</th>
<th align="center">white_irish</th>
<th align="center">etc.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">E02002562</td>
<td align="center">0.74</td>
<td align="center">0.03</td>
<td align="center">…</td>
</tr>
<tr class="even">
<td align="left">E02002560</td>
<td align="center">0.32</td>
<td align="center">0.32</td>
<td align="center">…</td>
</tr>
</tbody>
</table>
</div>
<div id="assignment-2" class="section level4 unnumbered">
<h4>Assignment 2</h4>
<p>Further to calculating the proportions of the population belonging to each of the ethnic groups in the UK 2011 Census of Population, we also want to make a choropleth map at district level of the UK population that is older than 60 as a proportion of the total population. For this analysis we have available one dataset with the administrative boundaries of the UK 2020 Local Authorithy Districts administrative geography and we have a <code>.csv</code> file that holds population data. Use everything you have learned over the past weeks to produces this map. Some tips:</p>
<ol style="list-style-type: decimal">
<li>Inspect both the shapefile and the <code>.csv</code> file to get an idea of how your data look like.</li>
<li>The data file does contain a mix of administrative geographies, and you will need to filter out <em>Country</em>, <em>County</em>, <em>Metropolitan County</em>, and <em>Region</em>.</li>
<li>You are in charge of deciding which tools you want to use to visualise the data (ArcGIS, R, QGIS, etc.)</li>
<li>You do not to do to everything that we have done in the practical so far, you now have to make your own decisions.</li>
</ol>
 
<center>
<p><strong>You can download the shapefile with the administrative boundaries <a href="https://github.com/jtvandijk/GEOG0114/tree/master/raw/administrative_boundaries/uk_lad_2020/LADs_uk_2020.zip">here</a>.</strong></p>
<strong>You can download the <code>.csv</code> file with the population data <a href="https://github.com/jtvandijk/GEOG0114/tree/master/raw/population/mye_pop_2019/mye_pop_2019.csv">here</a>.</strong>
</center>
<p> </p>
</div>
</div>
</div>
<div id="exploratory-spatial-data-analysis-in" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Exploratory (spatial) data analysis in</h2>
<p>Exploratory spatial data analysis (ESDA) is the extension of exploratory data analysis (EDA) to the spatial realm. EDA is a collection of descriptive techniques used to detect patterns, identiy outliers, and form hypotheses from the data. An EDA typically involves descriptive statistics and data visualisation. Exploratory techniques generally stay ‘close’ to the original data.</p>
<div id="short-lecture-exploratory-spatial-data-analysis" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Short lecture: Exploratory (spatial) data analysis</h3>
<p><a href="">[Lecture slides]</a> <a href="">[Watch on MS stream]</a></p>
</div>
</div>
<div id="spatial-heterogeneity" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Spatial heterogeneity</h2>
<div id="short-lecture-spatial-heterogeneity" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Short lecture: Spatial heterogeneity</h3>
<p><a href="">[Lecture slides]</a> <a href="">[Watch on MS stream]</a></p>
</div>
</div>
<div id="attributions_w05" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Attributions</h2>
<p>This week’s content and practical uses content and inspiration from:</p>
<ul>
<li>Wickham, H., Grolemund, G. 2017. R for Data Science. <a href="https://r4ds.had.co.nz/index.html" class="uri">https://r4ds.had.co.nz/index.html</a></li>
</ul>
</div>
<div id="feedback_w05" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Feedback</h2>
<p>Please take a moment to give us some <a href="https://forms.gle/BYbZySVSHeoUEkJh9">feedback on this week’s content</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial-autocorrelation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="point-pattern-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jtvandijk/GEOG0114/edit/master/05-week05_dev.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/jtvandijk/GEOG0114/raw/master/05-week05_dev.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
