<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Spatial autocorrelation | GEOG0114: Principles of Spatial Analysis</title>
  <meta name="description" content="GEOG114: Principles of Spatial Analysis handbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Spatial autocorrelation | GEOG0114: Principles of Spatial Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jtvandijk.github.io/GEOG0114/" />
  
  <meta property="og:description" content="GEOG114: Principles of Spatial Analysis handbook." />
  <meta name="github-repo" content="jtvandijk/GEOG0114" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Spatial autocorrelation | GEOG0114: Principles of Spatial Analysis" />
  
  <meta name="twitter:description" content="GEOG114: Principles of Spatial Analysis handbook." />
  

<meta name="author" content="Justin van Dijk and Joanna Wilkin" />


<meta name="date" content="2020-10-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial-properties-and-relationships.html"/>
<link rel="next" href="exploratory-spatial-data-analysis.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/module-catalogue/modules/principles-of-spatial-analysis-GEOG0114"><img src="images/general/ucl_logo.png">
</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#get-in-touch"><i class="fa fa-check"></i>Get in touch</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#noticed-a-mistake-in-this-resource"><i class="fa fa-check"></i>Noticed a mistake in this resource?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html"><i class="fa fa-check"></i>Course information</a>
<ul>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#module-structure"><i class="fa fa-check"></i>Module structure</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#weekly-topics"><i class="fa fa-check"></i>Weekly topics</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#learning-objectives"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#reading-list"><i class="fa fa-check"></i>Reading list</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#module-assessment-details"><i class="fa fa-check"></i>Module assessment details</a></li>
<li class="chapter" data-level="" data-path="course-information.html"><a href="course-information.html#useful-additional-resources"><i class="fa fa-check"></i>Useful additional resources</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="spatial-analysis-for-data-science.html"><a href="spatial-analysis-for-data-science.html"><i class="fa fa-check"></i><b>1</b> Spatial analysis for data science</a></li>
<li class="chapter" data-level="2" data-path="geographical-representation.html"><a href="geographical-representation.html"><i class="fa fa-check"></i><b>2</b> Geographical representation</a></li>
<li class="chapter" data-level="3" data-path="spatial-properties-and-relationships.html"><a href="spatial-properties-and-relationships.html"><i class="fa fa-check"></i><b>3</b> Spatial properties and relationships</a></li>
<li class="chapter" data-level="4" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html"><i class="fa fa-check"></i><b>4</b> Spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#neighbours"><i class="fa fa-check"></i><b>4.1</b> Neighbours</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#setting-up-the-environment"><i class="fa fa-check"></i><b>4.1.1</b> Setting up the environment</a></li>
<li class="chapter" data-level="4.1.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#euclidean-neighbours"><i class="fa fa-check"></i><b>4.1.2</b> Euclidean neighbours</a></li>
<li class="chapter" data-level="4.1.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#shared-boundary-neighbours"><i class="fa fa-check"></i><b>4.1.3</b> Shared boundary neighbours</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#quantifying-difference-over-space"><i class="fa fa-check"></i><b>4.2</b> Quantifying difference over space</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#our-property-is-theft."><i class="fa fa-check"></i><b>4.2.1</b> Our property is theft.</a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#global-morans-i"><i class="fa fa-check"></i><b>4.2.2</b> Global Moran’s I</a></li>
<li class="chapter" data-level="4.2.3" data-path="spatial-autocorrelation.html"><a href="spatial-autocorrelation.html#local-morans-i"><i class="fa fa-check"></i><b>4.2.3</b> Local Moran’s I</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html"><i class="fa fa-check"></i><b>5</b> Exploratory spatial data analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#introduction_w05"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#overview_w05"><i class="fa fa-check"></i><b>5.1.1</b> Video: Overview</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#tidy-data"><i class="fa fa-check"></i><b>5.2</b> Tidy data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#video-tidy-data"><i class="fa fa-check"></i><b>5.2.1</b> Video: Tidy data</a></li>
<li class="chapter" data-level="5.2.2" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#what-do-tidy-data-look-like"><i class="fa fa-check"></i><b>5.2.2</b> What do tidy data look like?</a></li>
<li class="chapter" data-level="5.2.3" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#example-creating-tidy-data"><i class="fa fa-check"></i><b>5.2.3</b> Example: Creating tidy data</a></li>
<li class="chapter" data-level="5.2.4" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#assignment_w05"><i class="fa fa-check"></i><b>5.2.4</b> Assignments</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#exploratory-spatial-data-analysis-in-r"><i class="fa fa-check"></i><b>5.3</b> Exploratory spatial data analysis in R</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#example-exploring-our-dataset"><i class="fa fa-check"></i><b>5.3.1</b> Example: Exploring our dataset</a></li>
<li class="chapter" data-level="5.3.2" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#video-exploratory-spatial-data-analysis"><i class="fa fa-check"></i><b>5.3.2</b> Video: Exploratory spatial data analysis</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#spatial-heterogeneity"><i class="fa fa-check"></i><b>5.4</b> Spatial heterogeneity</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#video-spatial-heterogeneity"><i class="fa fa-check"></i><b>5.4.1</b> Video: Spatial heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#attributions_w05"><i class="fa fa-check"></i><b>5.5</b> Attributions</a></li>
<li class="chapter" data-level="5.6" data-path="exploratory-spatial-data-analysis.html"><a href="exploratory-spatial-data-analysis.html#feedback_w05"><i class="fa fa-check"></i><b>5.6</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html"><i class="fa fa-check"></i><b>6</b> Point pattern analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#feedback_w06"><i class="fa fa-check"></i><b>6.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="geostatistics.html"><a href="geostatistics.html"><i class="fa fa-check"></i><b>7</b> Geostatistics</a>
<ul>
<li class="chapter" data-level="7.1" data-path="geostatistics.html"><a href="geostatistics.html#feedback_w07"><i class="fa fa-check"></i><b>7.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cluster-analysis.html"><a href="cluster-analysis.html"><i class="fa fa-check"></i><b>8</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#feedback_w08"><i class="fa fa-check"></i><b>8.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-modelling.html"><a href="bayesian-modelling.html"><i class="fa fa-check"></i><b>9</b> Bayesian modelling</a></li>
<li class="chapter" data-level="10" data-path="reproducible-research.html"><a href="reproducible-research.html"><i class="fa fa-check"></i><b>10</b> Reproducible research</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEOG0114: Principles of Spatial Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-autocorrelation" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Spatial autocorrelation</h1>
<div class="figure" style="text-align: center"><span id="fig:04-spatial-distribution-qual-data"></span>
<img src="images/week04/04_a_spatial_auto_correlation_map.png" alt="Spatial distribution of qualitative data taken from the [Colorbrewer 2.0 website](https://colorbrewer2.org/#type=qualitative&amp;scheme=Set2&amp;n=3)." width="80%" />
<p class="caption">
Figure 4.1: Spatial distribution of qualitative data taken from the <a href="https://colorbrewer2.org/#type=qualitative&amp;scheme=Set2&amp;n=3">Colorbrewer 2.0 website</a>.
</p>
</div>
<p>This week, we focus on the first of two key properties of spatial data: spatial dependence. Spatial dependence is the idea, as introduced in the first week via Tobler’s Law (1970), that the observed value of a variable in one location is often dependent (to some degree) on the observed value of the same value in a nearby location. For spatial analysis, this dependence can be assessed and measured statistically by considering the level of spatial autocorrelation between values of a specific variable, observed in either different locations or between pairs of variables observed at the same location. Spatial autocorrelation occurs when these values are not independent of one another and instead cluster together across geographic space. A critical first step of spatial autocorrelation is to define the criteria under which a spatial unit (e.g. an areal or point unit) can be understood as a “neighbor” to another unit. As highlighted in the previous week, spatial properties can often take on several meanings, and as a result, have an impact on the validity and accuracy of spatial analysis. This multiplicity also can be applied to the concept of spatial neighbours which can be defined through adjacency, contiguity or distance-based measures. As the specification of these criteria can impact the results, the definition followed therefore need to be grounded in particular theory that aims to represent the process and variable investigated.</p>
<p>This week looks at spatial dependence and autocorrelation in detail, focusing on the different methods of assessment. As part of this, we look at the multiple methods to defining spatial neighbours and their suitability of use across different spatial phenomena – and how this approach is used to generate spatial weights for use within these spatial autocorrelation methods as well as their potential to generate spatially-explicit variables.</p>
<p>We put these learnings into practice through an analysis of spatial dependence of our areal crime data from Week 2, experimenting with the deployment of different neighbours and the impact of their analyses. For this practical we will look at the distribution of thefts from persons in the borough of Camden, home of the main UCL Campus, and birthplace of <a href="https://github.com/aclong">Alfie Long</a> (statue forthcoming).</p>
<div id="neighbours" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Neighbours</h2>
<p>If we want to come up with quantifiable descriptions of variables and how they vary over space, then we need to find ways of quantifying the distance from point to point. When you attach values to the polygons of wards in London, and visualise them, different patterns appear, and the different shapes and sizes of the polygons effect what these patterns look like. There can appear to be clusters, or the distribution can be random. If you want to explain and discuss variables, the underlying causes, and the possible solutions to issues, it becomes useful to quantify how clustered, or at the opposite end, how random these distributions are. This issue is known as spatial autocorrelation.</p>
<blockquote>
<p>“Things are more like things that are closer to them.”
- Tobler(ish)</p>
</blockquote>
<p>In raster data, variables are measured at regular spatial intervals (or interpolated to be represented as such). Each measurement is regularly spaced from its neighbours, like the pixels on the screen you are reading this from.</p>
<p>With vector data, the distance of measurement to measurement, and the size and shape of the “pixel” of measurement becomes part of the captured information. Whilst this can allow for more nuanced representations of spatial phenomena, it also means that the quantity and type of distance between measurements needs to be acknowledged. Quantify the relationship of “neighbour” allows this to be done systematically.</p>
<p>If you want to calculate the relative spatial relation of distributions, knowledge of what counts as a “neighbour” becomes useful. Neighbours can be neighbours due to euclidean distance (distance in space), or they can be due to shares relationships, like a shared boundary, or they can simply be the nearest neighbour, if there aren’t many other vectors around. Depending on the variable you are measuring the appropriateness of neighbourhood calculation techniques can change.</p>
<div id="setting-up-the-environment" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Setting up the environment</h3>
<p>To begin let’s load the libraries needed for this practical.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="spatial-autocorrelation.html#cb1-1" aria-hidden="true"></a><span class="co"># for spatial objects and operations</span></span>
<span id="cb1-2"><a href="spatial-autocorrelation.html#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="spatial-autocorrelation.html#cb3-1" aria-hidden="true"></a><span class="co"># for finding nearest neighbours in sf objects</span></span>
<span id="cb3-2"><a href="spatial-autocorrelation.html#cb3-2" aria-hidden="true"></a><span class="kw">library</span>(nngeo)</span>
<span id="cb3-3"><a href="spatial-autocorrelation.html#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="spatial-autocorrelation.html#cb3-4" aria-hidden="true"></a><span class="co"># for reading and quantifying data</span></span>
<span id="cb3-5"><a href="spatial-autocorrelation.html#cb3-5" aria-hidden="true"></a><span class="kw">library</span>(data.table)</span>
<span id="cb3-6"><a href="spatial-autocorrelation.html#cb3-6" aria-hidden="true"></a></span>
<span id="cb3-7"><a href="spatial-autocorrelation.html#cb3-7" aria-hidden="true"></a><span class="co"># for visualising spatial data</span></span>
<span id="cb3-8"><a href="spatial-autocorrelation.html#cb3-8" aria-hidden="true"></a><span class="kw">library</span>(tmap)</span></code></pre></div>
<p>Download the data and put it in a folder we can find. We will use the same structure as the data directory from the previous week. If you are using the same directory for this weeks work then you can put these files in the same directories. If not make new ones with names that work. Alternatively you can make your own structure and use that.</p>
<p>To follow along with the code as it is and not edit the file paths there should be a folder called “raw/” in your project working directory, if not best to make one. Inside this create a folder called “crime”. You can download the crime data we will be working with from <a href="https://julie.geog.ucl.ac.uk/~aclong/psa-course-data/raw/crime/2019_camden_theft_from_person.csv">here</a> and put it in the crime folder.</p>
<p>Inside the “raw” directory there should be a directory called “administrative_boundaries”. In here make a folder called “camden_oas_2011/”. You can download the shape data we will be using from <a href="https://julie.geog.ucl.ac.uk/~aclong/psa-course-data/raw/administrative_boundaries/camden_oas_2011/">here</a>.</p>
<p>To check that you have all the files you need have a look at what’s in these directories. We can create variables that hold a text version of the filepath, you can edit these to contain the filepath of your own copy of the data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="spatial-autocorrelation.html#cb4-1" aria-hidden="true"></a><span class="co"># make the filepath objects</span></span>
<span id="cb4-2"><a href="spatial-autocorrelation.html#cb4-2" aria-hidden="true"></a>shapefile_dir_path &lt;-<span class="st"> &quot;raw/administrative_boundaries/camden_oas_2011/&quot;</span></span>
<span id="cb4-3"><a href="spatial-autocorrelation.html#cb4-3" aria-hidden="true"></a></span>
<span id="cb4-4"><a href="spatial-autocorrelation.html#cb4-4" aria-hidden="true"></a>crime_data_dir_path &lt;-<span class="st"> &quot;raw/crime/&quot;</span></span>
<span id="cb4-5"><a href="spatial-autocorrelation.html#cb4-5" aria-hidden="true"></a></span>
<span id="cb4-6"><a href="spatial-autocorrelation.html#cb4-6" aria-hidden="true"></a><span class="co"># we can use list.files() with the direcotry names to find their contents</span></span>
<span id="cb4-7"><a href="spatial-autocorrelation.html#cb4-7" aria-hidden="true"></a></span>
<span id="cb4-8"><a href="spatial-autocorrelation.html#cb4-8" aria-hidden="true"></a><span class="co"># check for the files within these folders</span></span>
<span id="cb4-9"><a href="spatial-autocorrelation.html#cb4-9" aria-hidden="true"></a><span class="kw">list.files</span>(shapefile_dir_path)</span></code></pre></div>
<pre><code>## [1] &quot;OAs_camden_2011.dbf&quot; &quot;OAs_camden_2011.prj&quot; &quot;OAs_camden_2011.shp&quot;
## [4] &quot;OAs_camden_2011.shx&quot; &quot;OAs_camden_2011.zip&quot;</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="spatial-autocorrelation.html#cb6-1" aria-hidden="true"></a><span class="kw">list.files</span>(crime_data_dir_path)</span></code></pre></div>
<pre><code>## [1] &quot;2019_camden_theft_from_person.csv&quot;</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="spatial-autocorrelation.html#cb8-1" aria-hidden="true"></a><span class="co"># then we can assign the filenames to variables as well</span></span>
<span id="cb8-2"><a href="spatial-autocorrelation.html#cb8-2" aria-hidden="true"></a></span>
<span id="cb8-3"><a href="spatial-autocorrelation.html#cb8-3" aria-hidden="true"></a>shapefile_name &lt;-<span class="st"> &quot;OAs_camden_2011.shp&quot;</span></span>
<span id="cb8-4"><a href="spatial-autocorrelation.html#cb8-4" aria-hidden="true"></a></span>
<span id="cb8-5"><a href="spatial-autocorrelation.html#cb8-5" aria-hidden="true"></a>crimedata_filename &lt;-<span class="st"> &quot;2019_camden_theft_from_person.csv&quot;</span></span>
<span id="cb8-6"><a href="spatial-autocorrelation.html#cb8-6" aria-hidden="true"></a></span>
<span id="cb8-7"><a href="spatial-autocorrelation.html#cb8-7" aria-hidden="true"></a><span class="co"># you can use paste0() to add these together as complete filepaths</span></span>
<span id="cb8-8"><a href="spatial-autocorrelation.html#cb8-8" aria-hidden="true"></a><span class="kw">paste0</span>(shapefile_dir_path, shapefile_name)</span></code></pre></div>
<pre><code>## [1] &quot;raw/administrative_boundaries/camden_oas_2011/OAs_camden_2011.shp&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="spatial-autocorrelation.html#cb10-1" aria-hidden="true"></a><span class="kw">paste0</span>(crime_data_dir_path, crimedata_filename)</span></code></pre></div>
<pre><code>## [1] &quot;raw/crime/2019_camden_theft_from_person.csv&quot;</code></pre>
<p>Now we know the data is there we can load and plot the shape data.</p>
<p>Plot the output areas of the borough Camden.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="spatial-autocorrelation.html#cb12-1" aria-hidden="true"></a><span class="co"># first read in the data</span></span>
<span id="cb12-2"><a href="spatial-autocorrelation.html#cb12-2" aria-hidden="true"></a>camden_oas &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw">paste0</span>(shapefile_dir_path, shapefile_name), </span>
<span id="cb12-3"><a href="spatial-autocorrelation.html#cb12-3" aria-hidden="true"></a>                      <span class="co"># the filename of the shapefile</span></span>
<span id="cb12-4"><a href="spatial-autocorrelation.html#cb12-4" aria-hidden="true"></a>                      <span class="dt">crs=</span><span class="dv">27700</span></span>
<span id="cb12-5"><a href="spatial-autocorrelation.html#cb12-5" aria-hidden="true"></a>                      <span class="co"># the projection information of the shape</span></span>
<span id="cb12-6"><a href="spatial-autocorrelation.html#cb12-6" aria-hidden="true"></a>                      <span class="co"># as we know it is in British National Grid</span></span>
<span id="cb12-7"><a href="spatial-autocorrelation.html#cb12-7" aria-hidden="true"></a>                      )</span></code></pre></div>
<pre><code>## Reading layer `OAs_camden_2011&#39; from data source `/Users/Tycho/Dropbox/UCL/Web/jtvandijk.github.io/GEOG0114/raw/administrative_boundaries/camden_oas_2011/OAs_camden_2011.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 749 features and 17 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 523954.5 ymin: 180965.4 xmax: 531554.9 ymax: 187603.6
## CRS:            EPSG:27700</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="spatial-autocorrelation.html#cb14-1" aria-hidden="true"></a><span class="co"># plot it to have a look</span></span>
<span id="cb14-2"><a href="spatial-autocorrelation.html#cb14-2" aria-hidden="true"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(camden_oas))</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-b-plotting-camden-OAs-1.png" width="672" /></p>
<p>You can see how one of these output areas could have many more neighbours than others, they vary a great deal in size and shape. The dimensions of these objects change over space, as a result the measurements within them must change too.</p>
<p>Output areas are designed to convey and contain census information, so they are created in a way that maintains a similar number of residents in each one. The more sparsely populated an OA the larger it is. Output Areas are designed to cover the entirety of the land of England and Wales so they stretch over places where there are no people. In the north of Camden the largest Ouput Areas span over Hampstead Heath, a large park.</p>
<p>Let’s explore how to find different kinds of neighbours using the example of one randomly selected output area.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="spatial-autocorrelation.html#cb15-1" aria-hidden="true"></a><span class="co"># we have randomly selected one OA &quot;E00004174&quot;, the OA containing the UCL main campus </span></span>
<span id="cb15-2"><a href="spatial-autocorrelation.html#cb15-2" aria-hidden="true"></a><span class="co"># and coincidentally also the birthplace of Alfie Long (statue forthcoming)</span></span>
<span id="cb15-3"><a href="spatial-autocorrelation.html#cb15-3" aria-hidden="true"></a></span>
<span id="cb15-4"><a href="spatial-autocorrelation.html#cb15-4" aria-hidden="true"></a><span class="co"># highlight it in a map using tmap</span></span>
<span id="cb15-5"><a href="spatial-autocorrelation.html#cb15-5" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span></span>
<span id="cb15-6"><a href="spatial-autocorrelation.html#cb15-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">col=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span></span>
<span id="cb15-7"><a href="spatial-autocorrelation.html#cb15-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD<span class="op">==</span><span class="st">&quot;E00004174&quot;</span>,]) <span class="op">+</span></span>
<span id="cb15-8"><a href="spatial-autocorrelation.html#cb15-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-c-highlighting-one-oa-1.png" width="672" /></p>
</div>
<div id="euclidean-neighbours" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Euclidean neighbours</h3>
<p>The first way we are going to call something a neighbour is by using Euclidean distance. As our OA shapefile is projected in BNG (British National Grid), the coordinates are planar, going up 1 is the same distance as going sideways 1. Even better the coordinates are in metric measurements so it’s easy to make up heuristic distances.</p>
<p>Let’s call every output area with a centroid 500m or less away from the centroid of our chosen OA a neighbour.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="spatial-autocorrelation.html#cb16-1" aria-hidden="true"></a><span class="co"># make a variable for our chosen output area so that we could change </span></span>
<span id="cb16-2"><a href="spatial-autocorrelation.html#cb16-2" aria-hidden="true"></a><span class="co"># it and all the other code could remain the same</span></span>
<span id="cb16-3"><a href="spatial-autocorrelation.html#cb16-3" aria-hidden="true"></a>chosen_oa &lt;-<span class="st"> &quot;E00004174&quot;</span></span>
<span id="cb16-4"><a href="spatial-autocorrelation.html#cb16-4" aria-hidden="true"></a></span>
<span id="cb16-5"><a href="spatial-autocorrelation.html#cb16-5" aria-hidden="true"></a><span class="co"># find only nearest neighbours to our chosen output area centroid, find all within 500 meters</span></span>
<span id="cb16-6"><a href="spatial-autocorrelation.html#cb16-6" aria-hidden="true"></a><span class="co"># select only the the centroid of our chosen output area and all other areas (with st_centroid)</span></span>
<span id="cb16-7"><a href="spatial-autocorrelation.html#cb16-7" aria-hidden="true"></a><span class="co"># we set the maximum number of neighbours we want to find to &quot;50&quot; (with parameter k)</span></span>
<span id="cb16-8"><a href="spatial-autocorrelation.html#cb16-8" aria-hidden="true"></a><span class="co"># we set the maximum distance of calling an OA centroid a neigbour to &quot;500&quot; (with parameter maxdist)</span></span>
<span id="cb16-9"><a href="spatial-autocorrelation.html#cb16-9" aria-hidden="true"></a><span class="co"># we return a sparse matrix that tells us whether each OA is a neighbour or not (with parameter sparse)</span></span>
<span id="cb16-10"><a href="spatial-autocorrelation.html#cb16-10" aria-hidden="true"></a>chosen_oa_neighbours &lt;-<span class="st"> </span><span class="kw">st_nn</span>(<span class="kw">st_geometry</span>(<span class="kw">st_centroid</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD<span class="op">==</span>chosen_oa,])), </span>
<span id="cb16-11"><a href="spatial-autocorrelation.html#cb16-11" aria-hidden="true"></a>                              <span class="kw">st_geometry</span>(<span class="kw">st_centroid</span>(camden_oas)),</span>
<span id="cb16-12"><a href="spatial-autocorrelation.html#cb16-12" aria-hidden="true"></a>                              <span class="dt">sparse =</span> <span class="ot">TRUE</span>,</span>
<span id="cb16-13"><a href="spatial-autocorrelation.html#cb16-13" aria-hidden="true"></a>                              <span class="dt">k =</span> <span class="dv">50</span>,</span>
<span id="cb16-14"><a href="spatial-autocorrelation.html#cb16-14" aria-hidden="true"></a>                              <span class="dt">maxdist =</span> <span class="dv">500</span>) </span></code></pre></div>
<pre><code>## projected points</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="spatial-autocorrelation.html#cb18-1" aria-hidden="true"></a><span class="co"># see the output</span></span>
<span id="cb18-2"><a href="spatial-autocorrelation.html#cb18-2" aria-hidden="true"></a><span class="kw">class</span>(chosen_oa_neighbours)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="spatial-autocorrelation.html#cb20-1" aria-hidden="true"></a><span class="co"># this is a list object that contains the row number of all the found numbers</span></span>
<span id="cb20-2"><a href="spatial-autocorrelation.html#cb20-2" aria-hidden="true"></a><span class="co"># you can access the pure vector of these numbers by using [[1]] notation</span></span>
<span id="cb20-3"><a href="spatial-autocorrelation.html#cb20-3" aria-hidden="true"></a><span class="co"># this can then be used to subset the OA output areas object</span></span>
<span id="cb20-4"><a href="spatial-autocorrelation.html#cb20-4" aria-hidden="true"></a></span>
<span id="cb20-5"><a href="spatial-autocorrelation.html#cb20-5" aria-hidden="true"></a><span class="co"># get the names (codes) of these neighbours</span></span>
<span id="cb20-6"><a href="spatial-autocorrelation.html#cb20-6" aria-hidden="true"></a>neighbour_names &lt;-<span class="st"> </span>camden_oas[chosen_oa_neighbours[[<span class="dv">1</span>]],]</span>
<span id="cb20-7"><a href="spatial-autocorrelation.html#cb20-7" aria-hidden="true"></a>neighbour_names &lt;-<span class="st"> </span>neighbour_names<span class="op">$</span>OA11CD</span>
<span id="cb20-8"><a href="spatial-autocorrelation.html#cb20-8" aria-hidden="true"></a></span>
<span id="cb20-9"><a href="spatial-autocorrelation.html#cb20-9" aria-hidden="true"></a><span class="co"># plot the borough OA outlines in black with </span></span>
<span id="cb20-10"><a href="spatial-autocorrelation.html#cb20-10" aria-hidden="true"></a><span class="co"># the chosen oa filled in red and </span></span>
<span id="cb20-11"><a href="spatial-autocorrelation.html#cb20-11" aria-hidden="true"></a><span class="co"># the neighbours in green</span></span>
<span id="cb20-12"><a href="spatial-autocorrelation.html#cb20-12" aria-hidden="true"></a></span>
<span id="cb20-13"><a href="spatial-autocorrelation.html#cb20-13" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-14"><a href="spatial-autocorrelation.html#cb20-14" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb20-15"><a href="spatial-autocorrelation.html#cb20-15" aria-hidden="true"></a><span class="st">  </span><span class="co"># highlight only the neighbours</span></span>
<span id="cb20-16"><a href="spatial-autocorrelation.html#cb20-16" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD <span class="op">%in%</span><span class="st"> </span>neighbour_names,]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-17"><a href="spatial-autocorrelation.html#cb20-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span></span>
<span id="cb20-18"><a href="spatial-autocorrelation.html#cb20-18" aria-hidden="true"></a><span class="st">  </span><span class="co"># highlight only the chosen OA</span></span>
<span id="cb20-19"><a href="spatial-autocorrelation.html#cb20-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD<span class="op">==</span>chosen_oa,]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-20"><a href="spatial-autocorrelation.html#cb20-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb20-21"><a href="spatial-autocorrelation.html#cb20-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span><span class="st"> </span></span>
<span id="cb20-22"><a href="spatial-autocorrelation.html#cb20-22" aria-hidden="true"></a><span class="st">  </span><span class="co"># overlay the borders</span></span>
<span id="cb20-23"><a href="spatial-autocorrelation.html#cb20-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-d-euclidean-distance-neighbour-1.png" width="672" /></p>
</div>
<div id="shared-boundary-neighbours" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Shared boundary neighbours</h3>
<p>The next way of calculating neighbours takes into account the actual shape and location of the polygons in our shapefile.</p>
<p>This has only recently been added to the world of <code>sf()</code>, previously we would have reverted to using the <code>sp()</code> package and others that depend on it such as <code>spdep()</code>.</p>
<p>I’ve actually taken this bit of code from an issue raised in the Git repository of the sf package. You can look at it <a href="https://github.com/r-spatial/sf/issues/234#issuecomment-299013710">here</a>.</p>
<p>We create functions that check whether any polygons share boundaries or overlap one another, and then also check by how much. These new functions are based on the <code>st_relate()</code> function.</p>
<p>The different cases of these are known as queen, and rook. These describe the relations in a similar way to the possible chess board movements of these pieces.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="spatial-autocorrelation.html#cb21-1" aria-hidden="true"></a><span class="co"># for rook case</span></span>
<span id="cb21-2"><a href="spatial-autocorrelation.html#cb21-2" aria-hidden="true"></a>st_rook =<span class="st"> </span><span class="cf">function</span>(a, <span class="dt">b =</span> a) <span class="kw">st_relate</span>(a, b, <span class="dt">pattern =</span> <span class="st">&quot;F***1****&quot;</span>)</span>
<span id="cb21-3"><a href="spatial-autocorrelation.html#cb21-3" aria-hidden="true"></a></span>
<span id="cb21-4"><a href="spatial-autocorrelation.html#cb21-4" aria-hidden="true"></a><span class="co"># for queen case</span></span>
<span id="cb21-5"><a href="spatial-autocorrelation.html#cb21-5" aria-hidden="true"></a>st_queen &lt;-<span class="st"> </span><span class="cf">function</span>(a, <span class="dt">b =</span> a) <span class="kw">st_relate</span>(a, b, <span class="dt">pattern =</span> <span class="st">&quot;F***T****&quot;</span>)</span>
<span id="cb21-6"><a href="spatial-autocorrelation.html#cb21-6" aria-hidden="true"></a></span>
<span id="cb21-7"><a href="spatial-autocorrelation.html#cb21-7" aria-hidden="true"></a><span class="co"># these methods are now in the documetation for st_relate()</span></span>
<span id="cb21-8"><a href="spatial-autocorrelation.html#cb21-8" aria-hidden="true"></a><span class="co"># have a look in the examples at the bottom of the documentation</span></span>
<span id="cb21-9"><a href="spatial-autocorrelation.html#cb21-9" aria-hidden="true"></a><span class="co"># st_relate()</span></span></code></pre></div>
<p>Now that we’ve created the functions lets try them out.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="spatial-autocorrelation.html#cb22-1" aria-hidden="true"></a><span class="co"># let&#39;s use the same example oa as previously</span></span>
<span id="cb22-2"><a href="spatial-autocorrelation.html#cb22-2" aria-hidden="true"></a><span class="co"># you can check that it exists and if not assign the variable again</span></span>
<span id="cb22-3"><a href="spatial-autocorrelation.html#cb22-3" aria-hidden="true"></a><span class="cf">if</span>(<span class="kw">exists</span>(<span class="st">&quot;chosen_oa&quot;</span>)<span class="op">==</span><span class="ot">TRUE</span>)</span>
<span id="cb22-4"><a href="spatial-autocorrelation.html#cb22-4" aria-hidden="true"></a>  {</span>
<span id="cb22-5"><a href="spatial-autocorrelation.html#cb22-5" aria-hidden="true"></a>  </span>
<span id="cb22-6"><a href="spatial-autocorrelation.html#cb22-6" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;You have already selected &quot;</span>,chosen_oa))</span>
<span id="cb22-7"><a href="spatial-autocorrelation.html#cb22-7" aria-hidden="true"></a></span>
<span id="cb22-8"><a href="spatial-autocorrelation.html#cb22-8" aria-hidden="true"></a>  }<span class="cf">else</span>{</span>
<span id="cb22-9"><a href="spatial-autocorrelation.html#cb22-9" aria-hidden="true"></a>  chosen_oa &lt;-<span class="st"> &quot;E00004174&quot;</span></span>
<span id="cb22-10"><a href="spatial-autocorrelation.html#cb22-10" aria-hidden="true"></a>  </span>
<span id="cb22-11"><a href="spatial-autocorrelation.html#cb22-11" aria-hidden="true"></a>  <span class="kw">print</span>(<span class="st">&quot;You have not yet assigned the variable chosen_oa in this session. You have now been assigned E00004174, home of the main UCL campus and birthplace of Alfie Long (statue forthcoming).&quot;</span>)</span>
<span id="cb22-12"><a href="spatial-autocorrelation.html#cb22-12" aria-hidden="true"></a>  </span>
<span id="cb22-13"><a href="spatial-autocorrelation.html#cb22-13" aria-hidden="true"></a>  }</span></code></pre></div>
<pre><code>## [1] &quot;You have already selected E00004174&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="spatial-autocorrelation.html#cb24-1" aria-hidden="true"></a><span class="co"># the neighbourhood assigning works in a very similar way to the way st_nn() works</span></span>
<span id="cb24-2"><a href="spatial-autocorrelation.html#cb24-2" aria-hidden="true"></a><span class="co"># this way we will return a sparse list for the row numbers that are neighbours </span></span>
<span id="cb24-3"><a href="spatial-autocorrelation.html#cb24-3" aria-hidden="true"></a><span class="co"># and use that to subset the oa shapefile</span></span>
<span id="cb24-4"><a href="spatial-autocorrelation.html#cb24-4" aria-hidden="true"></a>chosen_oa_neighbours &lt;-<span class="st"> </span><span class="kw">st_rook</span>(<span class="kw">st_geometry</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD<span class="op">==</span>chosen_oa,]), </span>
<span id="cb24-5"><a href="spatial-autocorrelation.html#cb24-5" aria-hidden="true"></a>                                <span class="kw">st_geometry</span>(camden_oas))</span>
<span id="cb24-6"><a href="spatial-autocorrelation.html#cb24-6" aria-hidden="true"></a></span>
<span id="cb24-7"><a href="spatial-autocorrelation.html#cb24-7" aria-hidden="true"></a><span class="co"># get the names of neighbours</span></span>
<span id="cb24-8"><a href="spatial-autocorrelation.html#cb24-8" aria-hidden="true"></a><span class="co"># get the names (codes) of these neighbours</span></span>
<span id="cb24-9"><a href="spatial-autocorrelation.html#cb24-9" aria-hidden="true"></a>neighbour_names &lt;-<span class="st"> </span>camden_oas[chosen_oa_neighbours[[<span class="dv">1</span>]],]</span>
<span id="cb24-10"><a href="spatial-autocorrelation.html#cb24-10" aria-hidden="true"></a>neighbour_names &lt;-<span class="st"> </span>neighbour_names<span class="op">$</span>OA11CD</span>
<span id="cb24-11"><a href="spatial-autocorrelation.html#cb24-11" aria-hidden="true"></a></span>
<span id="cb24-12"><a href="spatial-autocorrelation.html#cb24-12" aria-hidden="true"></a><span class="co"># plot the borough OA outlines in black with </span></span>
<span id="cb24-13"><a href="spatial-autocorrelation.html#cb24-13" aria-hidden="true"></a><span class="co"># the chosen oa filled in red and </span></span>
<span id="cb24-14"><a href="spatial-autocorrelation.html#cb24-14" aria-hidden="true"></a><span class="co"># the neighbours in green</span></span>
<span id="cb24-15"><a href="spatial-autocorrelation.html#cb24-15" aria-hidden="true"></a></span>
<span id="cb24-16"><a href="spatial-autocorrelation.html#cb24-16" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-17"><a href="spatial-autocorrelation.html#cb24-17" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb24-18"><a href="spatial-autocorrelation.html#cb24-18" aria-hidden="true"></a><span class="st">  </span><span class="co"># highlight only the neighbours</span></span>
<span id="cb24-19"><a href="spatial-autocorrelation.html#cb24-19" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD <span class="op">%in%</span><span class="st"> </span>neighbour_names,]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-20"><a href="spatial-autocorrelation.html#cb24-20" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;green&quot;</span>) <span class="op">+</span></span>
<span id="cb24-21"><a href="spatial-autocorrelation.html#cb24-21" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD<span class="op">==</span>chosen_oa,]) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-22"><a href="spatial-autocorrelation.html#cb24-22" aria-hidden="true"></a><span class="st">  </span><span class="co"># highlight only the chosen OA</span></span>
<span id="cb24-23"><a href="spatial-autocorrelation.html#cb24-23" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb24-24"><a href="spatial-autocorrelation.html#cb24-24" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span><span class="st"> </span></span>
<span id="cb24-25"><a href="spatial-autocorrelation.html#cb24-25" aria-hidden="true"></a><span class="st">  </span><span class="co"># overlay the borders</span></span>
<span id="cb24-26"><a href="spatial-autocorrelation.html#cb24-26" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-f-shared-boundary-neighbour-example-1.png" width="672" /></p>
<p>Because the tolerance of the shared boundaries in the st_rook pattern and the st_queen pattern in the example I have chosen they both assign the same neighbours. This is true for many non-square polygons as the difference is often given as whether two shapes share one or more points. Therefore the difference can have more to do with the resolution and alignment of your polygons than the actual spatial properties they represent.</p>
<p>They can and do find different neighbours in other situations. Follow the grid example in the <code>st_relate()</code> documentation if you want to see it working.</p>
</div>
</div>
<div id="quantifying-difference-over-space" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Quantifying difference over space</h2>
<p>Now that we have found the different ways of finding neighbours we can consider how they relate to one another.</p>
<p>There are two ways of looking at spatial autocorrelation:</p>
<ul>
<li><p><strong>Local:</strong> This is the difference between an area and its neighbours. You would expect neighbours to be similar, but you can find exceptional places and results by seeing if places are quantifiably mor like or dislike their neighbours than the average other place.</p></li>
<li><p><strong>Global:</strong> This is a way of creating a metric of how regularly or irregularly clustered the variables are over the entire area studied.</p></li>
</ul>
<p>But before we start that let’s get into the data we are going to use!</p>
<div id="our-property-is-theft." class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Our property is theft.</h3>
<p>We’ll be using personal theft data from around camden. Our neighbourhood analysis of spatial autocorrelation should allow us to quantify the pattern of distribution of reported theft from persons in Camden in 2019.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="spatial-autocorrelation.html#cb25-1" aria-hidden="true"></a><span class="co"># read in the data</span></span>
<span id="cb25-2"><a href="spatial-autocorrelation.html#cb25-2" aria-hidden="true"></a>camden_theft &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;raw/crime/2019_camden_theft_from_person.csv&quot;</span>)</span>
<span id="cb25-3"><a href="spatial-autocorrelation.html#cb25-3" aria-hidden="true"></a></span>
<span id="cb25-4"><a href="spatial-autocorrelation.html#cb25-4" aria-hidden="true"></a><span class="co"># this is a csv, and the coordinates are in columns called &quot;X&quot; and &quot;Y&quot;</span></span>
<span id="cb25-5"><a href="spatial-autocorrelation.html#cb25-5" aria-hidden="true"></a><span class="co"># you can convert this into an sf object quite easily</span></span>
<span id="cb25-6"><a href="spatial-autocorrelation.html#cb25-6" aria-hidden="true"></a>camden_theft &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(camden_theft, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>),</span>
<span id="cb25-7"><a href="spatial-autocorrelation.html#cb25-7" aria-hidden="true"></a>                         <span class="dt">crs =</span> <span class="dv">27700</span>)</span>
<span id="cb25-8"><a href="spatial-autocorrelation.html#cb25-8" aria-hidden="true"></a></span>
<span id="cb25-9"><a href="spatial-autocorrelation.html#cb25-9" aria-hidden="true"></a><span class="co"># have a look at these points</span></span>
<span id="cb25-10"><a href="spatial-autocorrelation.html#cb25-10" aria-hidden="true"></a><span class="kw">plot</span>(camden_theft)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-g-loading-in-crime-data-1.png" width="672" /></p>
<p>This is point data, but we are interested in the polygons and how this data relates to the administrative boundaries it is within.</p>
<p>Let’s count the number of thefts in each OA. This is a spatial operation that is often called “point in polygon”. As we are just counting the number of occurences in each polygon it is quite easy. In the future you may often want to aggregate over points for an area, or in reverse assign values from the polygon to the points.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="spatial-autocorrelation.html#cb26-1" aria-hidden="true"></a><span class="co"># this code counts the lengths (number) of points that intersect each polygon</span></span>
<span id="cb26-2"><a href="spatial-autocorrelation.html#cb26-2" aria-hidden="true"></a><span class="co"># let&#39;s add a new column to our OA sf object called n_thefts to store this</span></span>
<span id="cb26-3"><a href="spatial-autocorrelation.html#cb26-3" aria-hidden="true"></a>camden_oas<span class="op">$</span>n_thefts &lt;-<span class="st"> </span><span class="kw">lengths</span>(<span class="kw">st_intersects</span>(camden_oas, camden_theft))</span>
<span id="cb26-4"><a href="spatial-autocorrelation.html#cb26-4" aria-hidden="true"></a></span>
<span id="cb26-5"><a href="spatial-autocorrelation.html#cb26-5" aria-hidden="true"></a><span class="co"># plot a quick map of it</span></span>
<span id="cb26-6"><a href="spatial-autocorrelation.html#cb26-6" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span></span>
<span id="cb26-7"><a href="spatial-autocorrelation.html#cb26-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col=</span><span class="st">&quot;n_thefts&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-h-point-in-polygon-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="spatial-autocorrelation.html#cb27-1" aria-hidden="true"></a><span class="co"># you can see our map is massively skewed by central london</span></span>
<span id="cb27-2"><a href="spatial-autocorrelation.html#cb27-2" aria-hidden="true"></a><span class="co"># meaning that the results in central london (the south of camden) </span></span>
<span id="cb27-3"><a href="spatial-autocorrelation.html#cb27-3" aria-hidden="true"></a><span class="co"># are so much larger than those in the north that it makes it harder</span></span>
<span id="cb27-4"><a href="spatial-autocorrelation.html#cb27-4" aria-hidden="true"></a><span class="co"># to see the smaller differences between other areas</span></span>
<span id="cb27-5"><a href="spatial-autocorrelation.html#cb27-5" aria-hidden="true"></a><span class="co"># try taking the square root of the number of thefts</span></span>
<span id="cb27-6"><a href="spatial-autocorrelation.html#cb27-6" aria-hidden="true"></a><span class="co"># (there are 0s in data so log would return some negatives)</span></span>
<span id="cb27-7"><a href="spatial-autocorrelation.html#cb27-7" aria-hidden="true"></a>camden_oas<span class="op">$</span>sqrt_n_thefts &lt;-<span class="st"> </span><span class="kw">sqrt</span>(camden_oas<span class="op">$</span>n_thefts)</span>
<span id="cb27-8"><a href="spatial-autocorrelation.html#cb27-8" aria-hidden="true"></a></span>
<span id="cb27-9"><a href="spatial-autocorrelation.html#cb27-9" aria-hidden="true"></a><span class="co"># plot a quick map of it</span></span>
<span id="cb27-10"><a href="spatial-autocorrelation.html#cb27-10" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas) <span class="op">+</span></span>
<span id="cb27-11"><a href="spatial-autocorrelation.html#cb27-11" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col=</span><span class="st">&quot;sqrt_n_thefts&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-h-point-in-polygon-2.png" width="672" /></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="spatial-autocorrelation.html#cb28-1" aria-hidden="true"></a><span class="co"># there: a much more nuanced picture</span></span></code></pre></div>
</div>
<div id="global-morans-i" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Global Moran’s I</h3>
<p>With a global Moran’s I we can test how “random” the spatial distribution of these values is. Global Moran’s I is a metric between -1 and 1. -1 is a completely even spatial distribution of values, 0 is a “random” distribution, and 1 is a “non-random” distribution of clearly defined clusters.</p>
<p>To calculate the global Moran’s I you need an adjacency matrix that contains the information of whether or not an OA is next to another, for an even more nuanced view you can include distance, or a distance weighting in the matrix rather than just the TRUE or FALSE, to take into account the strength of the nieghbourhoodness.</p>
<p>I will revisit the neighbourhood calculation used earlier then develop it from a one to all to an all to all computation.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="spatial-autocorrelation.html#cb29-1" aria-hidden="true"></a><span class="co"># here is the previous way of calculating neighbourhoodness for our chosen OA</span></span>
<span id="cb29-2"><a href="spatial-autocorrelation.html#cb29-2" aria-hidden="true"></a><span class="co"># but now we will add an extra argument that states we want a non-sparse adjacency matrix returned</span></span>
<span id="cb29-3"><a href="spatial-autocorrelation.html#cb29-3" aria-hidden="true"></a></span>
<span id="cb29-4"><a href="spatial-autocorrelation.html#cb29-4" aria-hidden="true"></a><span class="co"># find only nearest neighbours to our chosen output area centroid, find all within 500 meters</span></span>
<span id="cb29-5"><a href="spatial-autocorrelation.html#cb29-5" aria-hidden="true"></a><span class="co"># select only the the centroid of our chosen output area and all other areas (with st_centroid)</span></span>
<span id="cb29-6"><a href="spatial-autocorrelation.html#cb29-6" aria-hidden="true"></a><span class="co"># we set the maximum number of neighbours we want to find to &quot;50&quot; (with parameter k)</span></span>
<span id="cb29-7"><a href="spatial-autocorrelation.html#cb29-7" aria-hidden="true"></a><span class="co"># we set the maximum distance of calling an OA centroid a neigbour to &quot;500&quot; (with parameter maxdist)</span></span>
<span id="cb29-8"><a href="spatial-autocorrelation.html#cb29-8" aria-hidden="true"></a><span class="co"># we return a non-sparse matrix that tells us whether each OA is a neighbour or not (with parameter sparse)</span></span>
<span id="cb29-9"><a href="spatial-autocorrelation.html#cb29-9" aria-hidden="true"></a>chosen_oa_neighbours &lt;-<span class="st"> </span><span class="kw">st_nn</span>(<span class="kw">st_geometry</span>(<span class="kw">st_centroid</span>(camden_oas[camden_oas<span class="op">$</span>OA11CD<span class="op">==</span>chosen_oa,])), </span>
<span id="cb29-10"><a href="spatial-autocorrelation.html#cb29-10" aria-hidden="true"></a>                              <span class="kw">st_geometry</span>(<span class="kw">st_centroid</span>(camden_oas)),</span>
<span id="cb29-11"><a href="spatial-autocorrelation.html#cb29-11" aria-hidden="true"></a>                              <span class="dt">sparse =</span> <span class="ot">FALSE</span>,</span>
<span id="cb29-12"><a href="spatial-autocorrelation.html#cb29-12" aria-hidden="true"></a>                              <span class="dt">k=</span><span class="dv">50</span>,</span>
<span id="cb29-13"><a href="spatial-autocorrelation.html#cb29-13" aria-hidden="true"></a>                              <span class="dt">maxdist =</span> <span class="dv">500</span>) </span></code></pre></div>
<pre><code>## projected points</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="spatial-autocorrelation.html#cb31-1" aria-hidden="true"></a><span class="co"># check the object type</span></span>
<span id="cb31-2"><a href="spatial-autocorrelation.html#cb31-2" aria-hidden="true"></a><span class="kw">class</span>(chosen_oa_neighbours)</span></code></pre></div>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="spatial-autocorrelation.html#cb33-1" aria-hidden="true"></a><span class="co"># this single row matrix contains a true or false for each OA in the OA sf object indicating whether it is true or false</span></span>
<span id="cb33-2"><a href="spatial-autocorrelation.html#cb33-2" aria-hidden="true"></a><span class="co"># if you sum() it it counts the number of TRUEs in it</span></span>
<span id="cb33-3"><a href="spatial-autocorrelation.html#cb33-3" aria-hidden="true"></a><span class="kw">sum</span>(chosen_oa_neighbours)</span></code></pre></div>
<pre><code>## [1] 21</code></pre>
<p>Because of the way Moran’s I functions in R it is necessary to use <code>sp()</code> and <code>spdep()</code>.</p>
<p>So load them in.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="spatial-autocorrelation.html#cb35-1" aria-hidden="true"></a><span class="co"># for doing spatial operations (now mostly superseded by sf)</span></span>
<span id="cb35-2"><a href="spatial-autocorrelation.html#cb35-2" aria-hidden="true"></a><span class="kw">library</span>(sp)</span>
<span id="cb35-3"><a href="spatial-autocorrelation.html#cb35-3" aria-hidden="true"></a></span>
<span id="cb35-4"><a href="spatial-autocorrelation.html#cb35-4" aria-hidden="true"></a><span class="co"># for our neighbourhood and Moran&#39;s I analysis</span></span>
<span id="cb35-5"><a href="spatial-autocorrelation.html#cb35-5" aria-hidden="true"></a><span class="kw">library</span>(spdep)</span></code></pre></div>
<pre><code>## Loading required package: spData</code></pre>
<pre><code>## To access larger datasets in this package, install the spDataLarge
## package with: `install.packages(&#39;spDataLarge&#39;,
## repos=&#39;https://nowosad.github.io/drat/&#39;, type=&#39;source&#39;)`</code></pre>
<p>As you will see these methods and functions have quite esoteric and complicated syntax.</p>
<p>Some of the operations they will do will be similar to the examples shown earlier, but the way they assign and store variables makes it much quicker to run complex spatial operations.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="spatial-autocorrelation.html#cb38-1" aria-hidden="true"></a><span class="co"># check the current class</span></span>
<span id="cb38-2"><a href="spatial-autocorrelation.html#cb38-2" aria-hidden="true"></a><span class="kw">class</span>(camden_oas)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="spatial-autocorrelation.html#cb40-1" aria-hidden="true"></a><span class="co"># convert it to sp</span></span>
<span id="cb40-2"><a href="spatial-autocorrelation.html#cb40-2" aria-hidden="true"></a>camden_oas_sp &lt;-<span class="st"> </span><span class="kw">as_Spatial</span>(camden_oas, <span class="dt">IDs=</span>camden_oas<span class="op">$</span>OA11CD)</span>
<span id="cb40-3"><a href="spatial-autocorrelation.html#cb40-3" aria-hidden="true"></a></span>
<span id="cb40-4"><a href="spatial-autocorrelation.html#cb40-4" aria-hidden="true"></a><span class="co"># check the class of the new object</span></span>
<span id="cb40-5"><a href="spatial-autocorrelation.html#cb40-5" aria-hidden="true"></a><span class="kw">class</span>(camden_oas_sp)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPolygonsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<p>Now we can make the esoteric and timesaving “nb” object!</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="spatial-autocorrelation.html#cb42-1" aria-hidden="true"></a><span class="co"># make the nb</span></span>
<span id="cb42-2"><a href="spatial-autocorrelation.html#cb42-2" aria-hidden="true"></a>camden_oas_nb &lt;-<span class="st"> </span><span class="kw">poly2nb</span>(camden_oas_sp, <span class="dt">row.names=</span>camden_oas_sp<span class="op">$</span>OA11CD)</span>
<span id="cb42-3"><a href="spatial-autocorrelation.html#cb42-3" aria-hidden="true"></a></span>
<span id="cb42-4"><a href="spatial-autocorrelation.html#cb42-4" aria-hidden="true"></a><span class="co"># what kind of object is it?</span></span>
<span id="cb42-5"><a href="spatial-autocorrelation.html#cb42-5" aria-hidden="true"></a><span class="kw">class</span>(camden_oas_nb)</span></code></pre></div>
<pre><code>## [1] &quot;nb&quot;</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="spatial-autocorrelation.html#cb44-1" aria-hidden="true"></a><span class="co"># have a look inside</span></span>
<span id="cb44-2"><a href="spatial-autocorrelation.html#cb44-2" aria-hidden="true"></a><span class="kw">str</span>(camden_oas_nb,<span class="dt">list.len=</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## List of 749
##  $ : int [1:7] 10 15 215 303 327 375 464
##  $ : int [1:5] 19 72 309 365 430
##  $ : int [1:3] 133 152 709
##  $ : int [1:7] 78 131 152 286 314 582 651
##  $ : int [1:5] 67 316 486 492 703
##  $ : int [1:8] 7 68 317 487 556 612 625 638
##  $ : int [1:3] 6 68 317
##  $ : int [1:7] 57 58 164 358 429 605 684
##  $ : int [1:5] 58 164 489 609 700
##  $ : int [1:7] 1 215 245 311 327 366 644
##   [list output truncated]
##  - attr(*, &quot;class&quot;)= chr &quot;nb&quot;
##  - attr(*, &quot;region.id&quot;)= Factor w/ 749 levels &quot;E00004120&quot;,&quot;E00004121&quot;,..: 268 187 447 448 531 533 534 56 522 263 ...
##  - attr(*, &quot;call&quot;)= language poly2nb(pl = camden_oas_sp, row.names = camden_oas_sp$OA11CD)
##  - attr(*, &quot;type&quot;)= chr &quot;queen&quot;
##  - attr(*, &quot;sym&quot;)= logi TRUE</code></pre>
<p>It’s basically the same as the sparse list of neighbours that we created before using <code>st_nn()</code> and <code>st_rook()</code>. Now, however it will work with the <code>spdep()</code> ecosystem of functions.</p>
<p>If you look at the output you can see that it automatically uses “queen” case.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="spatial-autocorrelation.html#cb46-1" aria-hidden="true"></a><span class="co"># further into the sp rabbit hole we can now create a matrix from this (like the non-sparse output of the st_nn/st_rook processes)</span></span>
<span id="cb46-2"><a href="spatial-autocorrelation.html#cb46-2" aria-hidden="true"></a>camden_oas_nb_mat &lt;-<span class="st"> </span><span class="kw">nb2mat</span>(camden_oas_nb, <span class="dt">style=</span><span class="st">&#39;B&#39;</span>)</span>
<span id="cb46-3"><a href="spatial-autocorrelation.html#cb46-3" aria-hidden="true"></a></span>
<span id="cb46-4"><a href="spatial-autocorrelation.html#cb46-4" aria-hidden="true"></a><span class="co"># check the sum of one columnd</span></span>
<span id="cb46-5"><a href="spatial-autocorrelation.html#cb46-5" aria-hidden="true"></a><span class="kw">sum</span>(camden_oas_nb_mat[<span class="dv">1</span>,])</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="spatial-autocorrelation.html#cb48-1" aria-hidden="true"></a><span class="co"># where nb2mat() extends this is in allowing weighting</span></span>
<span id="cb48-2"><a href="spatial-autocorrelation.html#cb48-2" aria-hidden="true"></a>camden_oas_nb_mat &lt;-<span class="st"> </span><span class="kw">nb2mat</span>(camden_oas_nb, <span class="dt">style=</span><span class="st">&#39;W&#39;</span>)</span>
<span id="cb48-3"><a href="spatial-autocorrelation.html#cb48-3" aria-hidden="true"></a></span>
<span id="cb48-4"><a href="spatial-autocorrelation.html#cb48-4" aria-hidden="true"></a><span class="co"># check the sum of one column</span></span>
<span id="cb48-5"><a href="spatial-autocorrelation.html#cb48-5" aria-hidden="true"></a><span class="kw">sum</span>(camden_oas_nb_mat[<span class="dv">1</span>,])</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Now the sum of one row instead of being the total number of neighbours for that OA instead adds up to 1. This is important for the calculation of Moran’s I, as the metric is designed to return a values between -1 and 1. If the neghbour relations are not limited to add up to one the value for Moran’s I can exceed -1 and 1, and it loses meaning when compared against other cases.</p>
<p>Now we need to calculate a separate weights list object to use for the Moran’s I calculation.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="spatial-autocorrelation.html#cb50-1" aria-hidden="true"></a><span class="co"># create the list weights object</span></span>
<span id="cb50-2"><a href="spatial-autocorrelation.html#cb50-2" aria-hidden="true"></a>nb_weights_list &lt;-<span class="st"> </span><span class="kw">nb2listw</span>(camden_oas_nb, <span class="dt">style=</span><span class="st">&#39;B&#39;</span>)</span>
<span id="cb50-3"><a href="spatial-autocorrelation.html#cb50-3" aria-hidden="true"></a></span>
<span id="cb50-4"><a href="spatial-autocorrelation.html#cb50-4" aria-hidden="true"></a><span class="co"># have a look at the class</span></span>
<span id="cb50-5"><a href="spatial-autocorrelation.html#cb50-5" aria-hidden="true"></a><span class="kw">class</span>(nb_weights_list)</span></code></pre></div>
<pre><code>## [1] &quot;listw&quot; &quot;nb&quot;</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="spatial-autocorrelation.html#cb52-1" aria-hidden="true"></a><span class="co"># so it&#39;s nb AND weights</span></span>
<span id="cb52-2"><a href="spatial-autocorrelation.html#cb52-2" aria-hidden="true"></a></span>
<span id="cb52-3"><a href="spatial-autocorrelation.html#cb52-3" aria-hidden="true"></a><span class="co"># now use that to create a quick Moran&#39;s I</span></span>
<span id="cb52-4"><a href="spatial-autocorrelation.html#cb52-4" aria-hidden="true"></a><span class="kw">moran</span>(camden_oas_sp<span class="op">$</span>n_thefts, </span>
<span id="cb52-5"><a href="spatial-autocorrelation.html#cb52-5" aria-hidden="true"></a>      nb_weights_list, </span>
<span id="cb52-6"><a href="spatial-autocorrelation.html#cb52-6" aria-hidden="true"></a>      <span class="dt">n=</span><span class="kw">length</span>(nb_weights_list<span class="op">$</span>neighbours), </span>
<span id="cb52-7"><a href="spatial-autocorrelation.html#cb52-7" aria-hidden="true"></a>      <span class="dt">S0=</span><span class="kw">Szero</span>(nb_weights_list))</span></code></pre></div>
<pre><code>## $I
## [1] 0.5543285
## 
## $K
## [1] 75.21583</code></pre>
<p>On the scale of -1 to 1 where does it sit?</p>
<p>This is just a quick way to check the score. To do so properly you need to check between a randomly distributed version of the variables, and the variables as they are.</p>
<p>To do so you need to use the MonteCarlo method where you actually carry this out. You can specify how many times it does this to increase precision.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="spatial-autocorrelation.html#cb54-1" aria-hidden="true"></a><span class="co"># run it 599 times</span></span>
<span id="cb54-2"><a href="spatial-autocorrelation.html#cb54-2" aria-hidden="true"></a>mc_model &lt;-<span class="st"> </span><span class="kw">moran.mc</span>(camden_oas_sp<span class="op">$</span>n_thefts, nb_weights_list, <span class="dt">nsim=</span><span class="dv">599</span>)</span>
<span id="cb54-3"><a href="spatial-autocorrelation.html#cb54-3" aria-hidden="true"></a></span>
<span id="cb54-4"><a href="spatial-autocorrelation.html#cb54-4" aria-hidden="true"></a><span class="co"># what do we get?</span></span>
<span id="cb54-5"><a href="spatial-autocorrelation.html#cb54-5" aria-hidden="true"></a>mc_model</span></code></pre></div>
<pre><code>## 
## 	Monte-Carlo simulation of Moran I
## 
## data:  camden_oas_sp$n_thefts 
## weights: nb_weights_list  
## number of simulations + 1: 600 
## 
## statistic = 0.55433, observed rank = 600, p-value = 0.001667
## alternative hypothesis: greater</code></pre>
<p>This model shows that our distribution of thefts differs significantly from a random distribution.</p>
</div>
<div id="local-morans-i" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Local Moran’s I</h3>
<p>With a measurement of local spatial autocorrelation we could find hotspots of theft that are surrounded by areas of much lower theft. According to the previous global statistic these are not randomly distributed pockets but would be outliers against the general trend of clusteredness!</p>
<p>These could be areas that contain very specific locations, where interventions could be made that drastically reduce the rate of crime rather than other areas where there is a high level of ambient crime.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="spatial-autocorrelation.html#cb56-1" aria-hidden="true"></a><span class="co"># you need the nb object and the nb and weights list</span></span>
<span id="cb56-2"><a href="spatial-autocorrelation.html#cb56-2" aria-hidden="true"></a><span class="co"># make the nb</span></span>
<span id="cb56-3"><a href="spatial-autocorrelation.html#cb56-3" aria-hidden="true"></a>camden_oas_nb &lt;-<span class="st"> </span><span class="kw">poly2nb</span>(camden_oas_sp, <span class="dt">row.names=</span>camden_oas_sp<span class="op">$</span>OA11CD)</span>
<span id="cb56-4"><a href="spatial-autocorrelation.html#cb56-4" aria-hidden="true"></a></span>
<span id="cb56-5"><a href="spatial-autocorrelation.html#cb56-5" aria-hidden="true"></a><span class="co"># create the list weights object</span></span>
<span id="cb56-6"><a href="spatial-autocorrelation.html#cb56-6" aria-hidden="true"></a><span class="co"># but importantly with the row stadardisation this time</span></span>
<span id="cb56-7"><a href="spatial-autocorrelation.html#cb56-7" aria-hidden="true"></a>nb_weights_list &lt;-<span class="st"> </span><span class="kw">nb2listw</span>(camden_oas_nb, <span class="dt">style=</span><span class="st">&#39;W&#39;</span>)</span>
<span id="cb56-8"><a href="spatial-autocorrelation.html#cb56-8" aria-hidden="true"></a></span>
<span id="cb56-9"><a href="spatial-autocorrelation.html#cb56-9" aria-hidden="true"></a><span class="co"># use the localmoran() function</span></span>
<span id="cb56-10"><a href="spatial-autocorrelation.html#cb56-10" aria-hidden="true"></a>local_moran_camden_oa_theft &lt;-<span class="st"> </span><span class="kw">localmoran</span>(camden_oas_sp<span class="op">$</span>n_thefts, nb_weights_list)</span></code></pre></div>
<p>To properly utilise these local statistics and make in intuitively useful map we need to combine them with our crime count variable.</p>
<p>Because of the way the new variable will be calculated we need to rescale our variable so that the mean is 0. this means that the lowest values will be -ve and the highest +ve. The distribution and the relationship between the will be preserved though.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="spatial-autocorrelation.html#cb57-1" aria-hidden="true"></a><span class="co"># rescale that variable!</span></span>
<span id="cb57-2"><a href="spatial-autocorrelation.html#cb57-2" aria-hidden="true"></a>camden_oas_sp<span class="op">$</span>scale_n_thefts &lt;-<span class="st"> </span><span class="kw">scale</span>(camden_oas_sp<span class="op">$</span>n_thefts)</span></code></pre></div>
<p>To compare against its neighbours we need to create a new column that carries information about the neighbours.</p>
<p>This is called a spatial lag function! What fun!</p>
<p>The “lag” just refers to the fact you are comparing one observation against another, this can be used between timed observations. In this case, the “lag” we are looking at is between neighbours.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="spatial-autocorrelation.html#cb58-1" aria-hidden="true"></a><span class="co"># create a spatial lag variable and save it to a new column</span></span>
<span id="cb58-2"><a href="spatial-autocorrelation.html#cb58-2" aria-hidden="true"></a>camden_oas_sp<span class="op">$</span>lag_scale_n_thefts &lt;-<span class="st"> </span><span class="kw">lag.listw</span>(nb_weights_list, camden_oas_sp<span class="op">$</span>scale_n_thefts)</span></code></pre></div>
<p>Now we have used sp for all it is worth it’s time to head back to the safety of <code>sf()</code>!</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="spatial-autocorrelation.html#cb59-1" aria-hidden="true"></a><span class="co"># convert to sf</span></span>
<span id="cb59-2"><a href="spatial-autocorrelation.html#cb59-2" aria-hidden="true"></a>camden_oas_moran_stats &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(camden_oas_sp)</span></code></pre></div>
<p>To make a human readable version of the map we will generate some labels for our findings from the Local Moran’s I stats.</p>
<p>This process calculates what the value of each polygon is compared to its neighbours and works out if they are similar or dissimilar and in which way, then gives them a text label to describe the relationship.</p>
<p>I the text label, the first term describes the area being focused on and the second represents that areas neighbours.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="spatial-autocorrelation.html#cb60-1" aria-hidden="true"></a><span class="co"># run all of these through to assign variables</span></span>
<span id="cb60-2"><a href="spatial-autocorrelation.html#cb60-2" aria-hidden="true"></a></span>
<span id="cb60-3"><a href="spatial-autocorrelation.html#cb60-3" aria-hidden="true"></a><span class="co"># for the statistical significance version assign a level </span></span>
<span id="cb60-4"><a href="spatial-autocorrelation.html#cb60-4" aria-hidden="true"></a><span class="co"># of statistical significance for the p value, column 5 of the local moran model</span></span>
<span id="cb60-5"><a href="spatial-autocorrelation.html#cb60-5" aria-hidden="true"></a>sig_level &lt;-<span class="st"> </span><span class="fl">0.1</span></span>
<span id="cb60-6"><a href="spatial-autocorrelation.html#cb60-6" aria-hidden="true"></a></span>
<span id="cb60-7"><a href="spatial-autocorrelation.html#cb60-7" aria-hidden="true"></a><span class="co"># version with significance value</span></span>
<span id="cb60-8"><a href="spatial-autocorrelation.html#cb60-8" aria-hidden="true"></a>camden_oas_moran_stats<span class="op">$</span>quad_sig &lt;-<span class="st"> </span><span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-9"><a href="spatial-autocorrelation.html#cb60-9" aria-hidden="true"></a><span class="st">                                          </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-10"><a href="spatial-autocorrelation.html#cb60-10" aria-hidden="true"></a><span class="st">                                          </span>local_moran_camden_oa_theft[,<span class="dv">5</span>] <span class="op">&lt;=</span><span class="st"> </span>sig_level, </span>
<span id="cb60-11"><a href="spatial-autocorrelation.html#cb60-11" aria-hidden="true"></a>                                          <span class="st">&quot;high-high&quot;</span>, </span>
<span id="cb60-12"><a href="spatial-autocorrelation.html#cb60-12" aria-hidden="true"></a>                                   <span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-13"><a href="spatial-autocorrelation.html#cb60-13" aria-hidden="true"></a><span class="st">                                          </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-14"><a href="spatial-autocorrelation.html#cb60-14" aria-hidden="true"></a><span class="st">                                          </span>local_moran_camden_oa_theft[,<span class="dv">5</span>] <span class="op">&lt;=</span><span class="st"> </span>sig_level, </span>
<span id="cb60-15"><a href="spatial-autocorrelation.html#cb60-15" aria-hidden="true"></a>                                          <span class="st">&quot;low-low&quot;</span>, </span>
<span id="cb60-16"><a href="spatial-autocorrelation.html#cb60-16" aria-hidden="true"></a>                                   <span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-17"><a href="spatial-autocorrelation.html#cb60-17" aria-hidden="true"></a><span class="st">                                          </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-18"><a href="spatial-autocorrelation.html#cb60-18" aria-hidden="true"></a><span class="st">                                          </span>local_moran_camden_oa_theft[,<span class="dv">5</span>] <span class="op">&lt;=</span><span class="st"> </span>sig_level, </span>
<span id="cb60-19"><a href="spatial-autocorrelation.html#cb60-19" aria-hidden="true"></a>                                          <span class="st">&quot;high-low&quot;</span>, </span>
<span id="cb60-20"><a href="spatial-autocorrelation.html#cb60-20" aria-hidden="true"></a>                                   <span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-21"><a href="spatial-autocorrelation.html#cb60-21" aria-hidden="true"></a><span class="st">                                          </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-22"><a href="spatial-autocorrelation.html#cb60-22" aria-hidden="true"></a><span class="st">                                          </span>local_moran_camden_oa_theft[,<span class="dv">5</span>] <span class="op">&lt;=</span><span class="st"> </span>sig_level, </span>
<span id="cb60-23"><a href="spatial-autocorrelation.html#cb60-23" aria-hidden="true"></a>                                          <span class="st">&quot;low-high&quot;</span>,</span>
<span id="cb60-24"><a href="spatial-autocorrelation.html#cb60-24" aria-hidden="true"></a>                                   <span class="kw">ifelse</span>(local_moran_camden_oa_theft[,<span class="dv">5</span>] <span class="op">&gt;</span><span class="st"> </span>sig_level, </span>
<span id="cb60-25"><a href="spatial-autocorrelation.html#cb60-25" aria-hidden="true"></a>                                          <span class="st">&quot;not-significant&quot;</span>, </span>
<span id="cb60-26"><a href="spatial-autocorrelation.html#cb60-26" aria-hidden="true"></a>                                          <span class="st">&quot;not-significant&quot;</span>)))))</span>
<span id="cb60-27"><a href="spatial-autocorrelation.html#cb60-27" aria-hidden="true"></a></span>
<span id="cb60-28"><a href="spatial-autocorrelation.html#cb60-28" aria-hidden="true"></a><span class="co"># version without significance check</span></span>
<span id="cb60-29"><a href="spatial-autocorrelation.html#cb60-29" aria-hidden="true"></a>camden_oas_moran_stats<span class="op">$</span>quad_non_sig &lt;-<span class="st"> </span><span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-30"><a href="spatial-autocorrelation.html#cb60-30" aria-hidden="true"></a><span class="st">                                              </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, </span>
<span id="cb60-31"><a href="spatial-autocorrelation.html#cb60-31" aria-hidden="true"></a>                                              <span class="st">&quot;high-high&quot;</span>, </span>
<span id="cb60-32"><a href="spatial-autocorrelation.html#cb60-32" aria-hidden="true"></a>                                       <span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-33"><a href="spatial-autocorrelation.html#cb60-33" aria-hidden="true"></a><span class="st">                                              </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>, </span>
<span id="cb60-34"><a href="spatial-autocorrelation.html#cb60-34" aria-hidden="true"></a>                                              <span class="st">&quot;low-low&quot;</span>, </span>
<span id="cb60-35"><a href="spatial-autocorrelation.html#cb60-35" aria-hidden="true"></a>                                       <span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-36"><a href="spatial-autocorrelation.html#cb60-36" aria-hidden="true"></a><span class="st">                                              </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>, </span>
<span id="cb60-37"><a href="spatial-autocorrelation.html#cb60-37" aria-hidden="true"></a>                                              <span class="st">&quot;high-low&quot;</span>, </span>
<span id="cb60-38"><a href="spatial-autocorrelation.html#cb60-38" aria-hidden="true"></a>                                       <span class="kw">ifelse</span>(camden_oas_moran_stats<span class="op">$</span>scale_n_thefts <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb60-39"><a href="spatial-autocorrelation.html#cb60-39" aria-hidden="true"></a><span class="st">                                              </span>camden_oas_moran_stats<span class="op">$</span>lag_scale_n_thefts <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,</span>
<span id="cb60-40"><a href="spatial-autocorrelation.html#cb60-40" aria-hidden="true"></a>                                              <span class="st">&quot;low-high&quot;</span>,<span class="ot">NA</span>))))</span></code></pre></div>
<p>Now that the horrible looking conditional is finished we can see what we did.</p>
<p>To understand how this is working we can look at the data non-spatially. As we recentred the data, our axes should split the data neatly into their different area vs spatial lag relationship categories.</p>
<p>To do this plot we will need to use the plotting package <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="spatial-autocorrelation.html#cb61-1" aria-hidden="true"></a><span class="kw">library</span>(ggplot2)</span></code></pre></div>
<p>Let’s make the scatterplot using the scaled number of thefts for the areas in the x axis and their spatially lagged results in the y axis.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="spatial-autocorrelation.html#cb62-1" aria-hidden="true"></a><span class="co"># plot the results without the satistical significance</span></span>
<span id="cb62-2"><a href="spatial-autocorrelation.html#cb62-2" aria-hidden="true"></a><span class="kw">ggplot</span>(camden_oas_moran_stats, <span class="kw">aes</span>(<span class="dt">x =</span> scale_n_thefts, </span>
<span id="cb62-3"><a href="spatial-autocorrelation.html#cb62-3" aria-hidden="true"></a>                                   <span class="dt">y =</span> lag_scale_n_thefts, </span>
<span id="cb62-4"><a href="spatial-autocorrelation.html#cb62-4" aria-hidden="true"></a>                                   <span class="dt">color =</span> quad_non_sig)) <span class="op">+</span></span>
<span id="cb62-5"><a href="spatial-autocorrelation.html#cb62-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="co"># plot vertical line</span></span>
<span id="cb62-6"><a href="spatial-autocorrelation.html#cb62-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="co"># plot horizontal line</span></span>
<span id="cb62-7"><a href="spatial-autocorrelation.html#cb62-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Scaled Thefts (n)&quot;</span>) <span class="op">+</span></span>
<span id="cb62-8"><a href="spatial-autocorrelation.html#cb62-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Lagged Scaled Thefts (n)&quot;</span>) <span class="op">+</span></span>
<span id="cb62-9"><a href="spatial-autocorrelation.html#cb62-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour=</span><span class="st">&quot;Relative to neighbours&quot;</span>) <span class="op">+</span></span>
<span id="cb62-10"><a href="spatial-autocorrelation.html#cb62-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-v-plotting-quadrants-scatter-1.png" width="672" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="spatial-autocorrelation.html#cb63-1" aria-hidden="true"></a><span class="co"># plot the results nnw with the satistical significance</span></span>
<span id="cb63-2"><a href="spatial-autocorrelation.html#cb63-2" aria-hidden="true"></a><span class="kw">ggplot</span>(camden_oas_moran_stats, <span class="kw">aes</span>(<span class="dt">x =</span> scale_n_thefts, </span>
<span id="cb63-3"><a href="spatial-autocorrelation.html#cb63-3" aria-hidden="true"></a>                                   <span class="dt">y =</span> lag_scale_n_thefts, </span>
<span id="cb63-4"><a href="spatial-autocorrelation.html#cb63-4" aria-hidden="true"></a>                                   <span class="dt">color =</span> quad_sig)) <span class="op">+</span></span>
<span id="cb63-5"><a href="spatial-autocorrelation.html#cb63-5" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="co"># plot vertical line</span></span>
<span id="cb63-6"><a href="spatial-autocorrelation.html#cb63-6" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="co"># plot horizontal line</span></span>
<span id="cb63-7"><a href="spatial-autocorrelation.html#cb63-7" aria-hidden="true"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Scaled Thefts (n)&quot;</span>) <span class="op">+</span></span>
<span id="cb63-8"><a href="spatial-autocorrelation.html#cb63-8" aria-hidden="true"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Lagged Scaled Thefts (n)&quot;</span>) <span class="op">+</span></span>
<span id="cb63-9"><a href="spatial-autocorrelation.html#cb63-9" aria-hidden="true"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour=</span><span class="st">&quot;Relative to neighbours&quot;</span>) <span class="op">+</span></span>
<span id="cb63-10"><a href="spatial-autocorrelation.html#cb63-10" aria-hidden="true"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-v-plotting-quadrants-scatter-2.png" width="672" /></p>
<p>Now let’s see how they are arranged spatially.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="spatial-autocorrelation.html#cb64-1" aria-hidden="true"></a><span class="co"># map all of the results here</span></span>
<span id="cb64-2"><a href="spatial-autocorrelation.html#cb64-2" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas_moran_stats) <span class="op">+</span></span>
<span id="cb64-3"><a href="spatial-autocorrelation.html#cb64-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;quad_non_sig&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-s-mapping-local-moran-1.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="spatial-autocorrelation.html#cb65-1" aria-hidden="true"></a><span class="co"># map only the statistically significant results here</span></span>
<span id="cb65-2"><a href="spatial-autocorrelation.html#cb65-2" aria-hidden="true"></a><span class="kw">tm_shape</span>(camden_oas_moran_stats) <span class="op">+</span></span>
<span id="cb65-3"><a href="spatial-autocorrelation.html#cb65-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;quad_sig&quot;</span>)</span></code></pre></div>
<p><img src="GEOG0114_files/figure-html/04-s-mapping-local-moran-2.png" width="672" /></p>
<p>As our data are so spatially clustered we can’t see any outlier places (once we have ignored the non-significant results. This suggests that the pattern of theft from persons is not highly concentrated in very small areas or particular Output Areas, and instead is spread on a larger scale than we have used here.</p>
<p>To go further than we have today it would be possibe to run the exact same code but using a larger scale, perhaps LSOA, or Ward, and compare how this changes the Moran’s I statistics globally and locally.</p>
<p>Or, to gain statistical significance in looking at the difference between areas getting more data perhaps over a longer timescale, where there are less areas with 0 thefts.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial-properties-and-relationships.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-spatial-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jtvandijk/GEOG0114/edit/master/04-week04.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/jtvandijk/GEOG0114/raw/master/04-week04.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
